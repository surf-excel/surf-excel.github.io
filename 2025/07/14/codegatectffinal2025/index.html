<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Time: 2025.07.10-11 (onsite) I played Codegate CTF Final with r3kapig last week and we got 5th in the end.  Sincere thanks to my teammates and the organizers, I really enjoyed the game.  LEAk (12 solv">
<meta property="og:type" content="article">
<meta property="og:title" content="Codegate CTF 2025 Final">
<meta property="og:url" content="http://rechn0.github.io/2025/07/14/codegatectffinal2025/index.html">
<meta property="og:site_name" content="Rec|rEc|reC">
<meta property="og:description" content="Time: 2025.07.10-11 (onsite) I played Codegate CTF Final with r3kapig last week and we got 5th in the end.  Sincere thanks to my teammates and the organizers, I really enjoyed the game.  LEAk (12 solv">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://rechn0.github.io/2025/07/14/codegatectffinal2025/images/scoreboard.png">
<meta property="og:image" content="http://rechn0.github.io/2025/07/14/codegatectffinal2025/images/myongtong.jpg">
<meta property="og:image" content="http://rechn0.github.io/2025/07/14/codegatectffinal2025/images/yondae.jpg">
<meta property="article:published_time" content="2025-07-13T16:00:00.000Z">
<meta property="article:modified_time" content="2025-07-24T17:23:55.705Z">
<meta property="article:author" content="rec">
<meta property="article:tag" content="DFA">
<meta property="article:tag" content="DEX">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://rechn0.github.io/2025/07/14/codegatectffinal2025/images/scoreboard.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/1.png">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/1.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/1.png">
        
      
    
    <!-- title -->
    <title>Codegate CTF 2025 Final</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/links/">Links</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/07/23/sageenv/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/04/27/actf2025/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://rechn0.github.io/2025/07/14/codegatectffinal2025/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&text=Codegate CTF 2025 Final"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&is_video=false&description=Codegate CTF 2025 Final"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Codegate CTF 2025 Final&body=Check out this article: http://rechn0.github.io/2025/07/14/codegatectffinal2025/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&name=Codegate CTF 2025 Final&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&t=Codegate CTF 2025 Final"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#LEAk-12-solves"><span class="toc-number">1.</span> <span class="toc-text">LEAk (12 solves)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smartLock-10-solves"><span class="toc-number">2.</span> <span class="toc-text">smartLock (10 solves)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#In-Korea"><span class="toc-number">3.</span> <span class="toc-text">In Korea</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Codegate CTF 2025 Final
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">rec</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-07-13T16:00:00.000Z" class="dt-published" itemprop="datePublished">2025-07-14</time>
        
        (Updated: <time datetime="2025-07-24T17:23:55.705Z" class="dt-updated" itemprop="dateModified">2025-07-25</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/DEX/" rel="tag">DEX</a>, <a class="p-category" href="/tags/DFA/" rel="tag">DFA</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>Time: 2025.07.10-11 (onsite)</p>
<p>I played Codegate CTF Final with r3kapig last week and we got 5th in the end. </p>
<p>Sincere thanks to my teammates and the organizers, I really enjoyed the game.</p>
<p><img src="/2025/07/14/codegatectffinal2025/images/scoreboard.png" alt="scoreboard"></p>
<h2 id="LEAk-12-solves"><a href="#LEAk-12-solves" class="headerlink" title="LEAk (12 solves)"></a>LEAk (12 solves)</h2><blockquote>
<ul>
<li><a href="LEAk/LEAk.py">LEAk.py</a></li>
</ul>
</blockquote>
<p>This is a standard implementation of LEA, which is a ARX-style block cipher. Our target is to recover the key through 15 at maximum times of fault injection without the value of the fault.</p>
<p>And my solution is based on <a target="_blank" rel="noopener" href="https://eprint.iacr.org/2020/1534.pdf">this</a>. </p>
<p>The core of the attack is an algebraic representation of modular addition on $\mathbb{F}_{2^n}$. In short, we have the following equations if we try to inject a fault into the modular addition.</p>
<p>$$A \boxplus B &#x3D; C \Rightarrow A \boxplus (B \oplus \Delta B) &#x3D; C \oplus \Delta C$$</p>
<p>$$<br>\begin{cases}<br>c_0 &#x3D; a_0 + b_0 \\<br>c_i &#x3D; a_i + b_i + a_{i-1}b_{i-1} + (a_{i-1}+b_{i-1})(a_{i-1}+b_{i-1}+c_{i-1})\\<br>c_0+\Delta c_{0} &#x3D; a_0 + b_0 + \Delta b_0 \\<br>c_i+\Delta c_{i} &#x3D; a_i + b_i + \Delta b_i + a_{i-1}(b_{i-1}+\Delta b_{i-1}) + (a_{i-1}+b_{i-1}+\Delta b_{i-1})(a_{i-1}+b_{i-1}+\Delta b_{i-1}+c_{i-1})<br>\end{cases}<br>$$</p>
<p>With the knowledge of $(C, \Delta B, \Delta C)$, we can build a binary system with $2n$ variables, which can be solved through <code>Groebner Basis</code> or <code>z3-solver</code>. And we can recover the low $n-1$ bits of $(A, B)$ with enough samples (apparently we have no information about MSB).</p>
<p>In the second part we just need to choose the injection points, collect the outputs and recover the internal values using the above analysis. I implemented the paper’s strategy and here is a sketch.</p>
<ol>
<li>$\rightarrow X_{22}[0]$ for $RK_{23}[0]$ (31bit)</li>
<li>$\rightarrow X_{23}[1]$ for $RK_{23}[1] \oplus RK_{23}[2]$ (31bit)</li>
<li>$\rightarrow X_{23}[2]$ for $RK_{23}[3] \oplus RK_{23}[4]$ (31bit)</li>
<li>$\rightarrow X_{22}[0]$ (reuse stage 1) for $RK_{23}[5]$ (30bit)</li>
</ol>
<p>For more details you can check the original paper (and my exploit code). With some bruteforce on MSBs, we can recover the secret key.</p>
<p>In the paper the author takes 6 samples for each steps, and here we have only 5 (we need 1 sample for the original ciphertext). This slightly influences the success rate so we need several attempts.</p>
<blockquote>
<ul>
<li><a href="LEAk/exp.py">exp.py</a></li>
</ul>
</blockquote>
<p>It turns out the whole challenge is z3able but whatever :)</p>
<p>I actually enjoyed the implementation part, with snacks and classical music. Love and peace @codegate.</p>
<h2 id="smartLock-10-solves"><a href="#smartLock-10-solves" class="headerlink" title="smartLock (10 solves)"></a>smartLock (10 solves)</h2><blockquote>
<ul>
<li><a href="smartLock/smartLock.zip">smartLock</a></li>
</ul>
</blockquote>
<p>A tiny bug is that the server checks the answer by sending $m^d \pmod{n}$ and querying $m$, so we can just pass all the tests with the public keys. This can be figured out through the remote outputs.</p>
<p>According to our REer, we may need to solve 10 ACDP in 50s with strict parameters. I’ve not tried it but it might be all about optimizations ig.</p>
<blockquote>
<ul>
<li><a href="smartLock/exp.py">exp.py</a></li>
</ul>
</blockquote>
<h2 id="In-Korea"><a href="#In-Korea" class="headerlink" title="In Korea"></a>In Korea</h2><p>Charming Seoul City. The weather is similar to that in my hometown.</p>
<p>Kinda hot in the first two days, but it’s just pleasant after that.</p>
<p>Glad to meet so many old and new friends :D</p>
<table>
<thead>
<tr>
<th><img src="/2025/07/14/codegatectffinal2025/images/myongtong.jpg" alt="myongtong"></th>
<th><img src="/2025/07/14/codegatectffinal2025/images/yondae.jpg" alt="yondae"></th>
</tr>
</thead>
</table>
<!-- ## (blockchain) DEX (8 solves)

> - [DEX](DEX/DEX.zip)

Later that night I tried the blockchain challenge with my teammates. Something new for me XD

The structure of the challenge is well-designed and a little complicated for me. But many of them are meant for the correctness and fairness of the challenge, so I'll just focus on the core part.

The initialization is done by contract `Setup`. In short there are two `DEX` contracts, deployed on `CODE` and `GATE` chain. At first there are `DEX_SUPPLY` of `tokenA/B/C` on each DEX, and our target is to possess all of them (`2*DEX_SUPPLY` of each token). And of course, we don't have enough money to do that.

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">contract <span class="title class_">Setup</span> &#123;</span><br><span class="line">    uint256 public constant <span class="variable constant_">CODE_CHAIN</span> = <span class="number">10</span>;</span><br><span class="line">    uint256 public constant <span class="variable constant_">GATE_CHAIN</span> = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    address public dex;</span><br><span class="line">    address public tokenA;</span><br><span class="line">    address public tokenB;</span><br><span class="line">    address public tokenC;</span><br><span class="line">    address public faucet;</span><br><span class="line">    address public faucetLogic;</span><br><span class="line">    bool public isSolved = <span class="literal">false</span>;</span><br><span class="line">    uint256 public constant <span class="variable constant_">DEX_SUPPLY</span> = <span class="number">600</span> ether;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">address _faucet</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        faucetLogic = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">FaucetLogic</span>());</span><br><span class="line">        faucet  = _faucet;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(block.<span class="property">chainid</span> == <span class="variable constant_">CODE_CHAIN</span>) &#123;</span><br><span class="line">            tokenA = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;CODE USDC&quot;</span>, <span class="string">&quot;cUSDC&quot;</span>));</span><br><span class="line">            tokenB = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;CODE PURR&quot;</span>, <span class="string">&quot;cPURR&quot;</span>));</span><br><span class="line">            tokenC = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;CODE MOODENG&quot;</span>, <span class="string">&quot;cMOODENG&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tokenA = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;GATE USDC&quot;</span>, <span class="string">&quot;gUSDC&quot;</span>));</span><br><span class="line">            tokenB = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;GATE PURR&quot;</span>, <span class="string">&quot;gPURR&quot;</span>));</span><br><span class="line">            tokenC = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;GATE MOODENG&quot;</span>, <span class="string">&quot;gMOODENG&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Token</span>[] memory tokens = <span class="keyword">new</span> <span class="title class_">Token</span>[](<span class="number">3</span>);</span><br><span class="line">        tokens[<span class="number">0</span>] = <span class="title class_">Token</span>(tokenA);</span><br><span class="line">        tokens[<span class="number">1</span>] = <span class="title class_">Token</span>(tokenB);</span><br><span class="line">        tokens[<span class="number">2</span>] = <span class="title class_">Token</span>(tokenC);</span><br><span class="line"></span><br><span class="line">        dex = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title function_">DEX</span>(msg.<span class="property">sender</span>, tokens));</span><br><span class="line">        <span class="title class_">Token</span>(tokenA).<span class="title function_">mint</span>(<span class="title function_">address</span>(dex), <span class="variable constant_">DEX_SUPPLY</span>);</span><br><span class="line">        <span class="title class_">Token</span>(tokenB).<span class="title function_">mint</span>(<span class="title function_">address</span>(dex), <span class="variable constant_">DEX_SUPPLY</span>);</span><br><span class="line">        <span class="title class_">Token</span>(tokenC).<span class="title function_">mint</span>(<span class="title function_">address</span>(dex), <span class="variable constant_">DEX_SUPPLY</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Token</span>(tokenA).<span class="title function_">transferOwnership</span>(msg.<span class="property">sender</span>);</span><br><span class="line">        <span class="title class_">Token</span>(tokenB).<span class="title function_">transferOwnership</span>(msg.<span class="property">sender</span>);</span><br><span class="line">        <span class="title class_">Token</span>(tokenC).<span class="title function_">transferOwnership</span>(msg.<span class="property">sender</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getToken</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="keyword">if</span>(block.<span class="property">chainid</span> == <span class="variable constant_">GATE_CHAIN</span>) &#123;</span><br><span class="line">            <span class="title class_">Token</span>(tokenA).<span class="title function_">transfer</span>(faucet, <span class="number">100</span> ether);</span><br><span class="line">            <span class="title class_">Token</span>(tokenB).<span class="title function_">transfer</span>(faucet, <span class="number">100</span> ether);</span><br><span class="line">            <span class="title class_">Token</span>(tokenC).<span class="title function_">transfer</span>(faucet, <span class="number">100</span> ether);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">solve</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(block.<span class="property">chainid</span> == <span class="variable constant_">CODE_CHAIN</span>, <span class="string">&quot;Can be solved only on CODE CHAIN&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(<span class="title class_">Token</span>(tokenA).<span class="title function_">balanceOf</span>(msg.<span class="property">sender</span>) &gt;= <span class="variable constant_">DEX_SUPPLY</span> * <span class="number">2</span>, <span class="string">&quot;Not enough USDC&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(<span class="title class_">Token</span>(tokenB).<span class="title function_">balanceOf</span>(msg.<span class="property">sender</span>) &gt;= <span class="variable constant_">DEX_SUPPLY</span> * <span class="number">2</span>, <span class="string">&quot;Not enough PURR&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(<span class="title class_">Token</span>(tokenC).<span class="title function_">balanceOf</span>(msg.<span class="property">sender</span>) &gt;= <span class="variable constant_">DEX_SUPPLY</span> * <span class="number">2</span>, <span class="string">&quot;Not enough MOODENG&quot;</span>);</span><br><span class="line">        isSolved = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DEX</code> is the core contract in this challenge. The main duty for a DEX (Decentralized Exchange) is the exchange service, where users can exchange some <code>tokenA</code> to <code>tokenB</code> according to current exchange rate. </p>
<p>Two <code>DEX</code> are deployed on different chains in this challenge. If one <code>DEX</code> exhausts a certain token, it’ll initiate a transfer request for more tokens with the other <code>DEX</code>, which actually completes a cross-chain exchange. <code>Message</code> related codes are used to handle cross-chain requirements, kinda cool.</p>
<p>Here comes the core logic of <code>DEX</code> contract.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_swap</span>(<span class="params">address <span class="keyword">from</span>, address receiver, uint256 amount, bytes32 srcToken, bytes32 dstToken</span>) internal &#123;</span><br><span class="line">    uint256 rate = <span class="title function_">_getRate</span>(srcToken, dstToken);</span><br><span class="line">    <span class="title class_">Token</span> srcTokenAddress = <span class="title class_">Token</span>(tokenMapping[srcToken]);</span><br><span class="line">    <span class="title class_">Token</span> dstTokenAddress = <span class="title class_">Token</span>(tokenMapping[dstToken]);</span><br><span class="line">    uint256 targetAmount = amount * rate / <span class="number">1e6</span>;</span><br><span class="line">    uint256 diffAmount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(dstTokenAddress.<span class="title function_">balanceOf</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>)) &lt; targetAmount) &#123;</span><br><span class="line">        diffAmount = targetAmount - dstTokenAddress.<span class="title function_">balanceOf</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>));</span><br><span class="line">        targetAmount = dstTokenAddress.<span class="title function_">balanceOf</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>));</span><br><span class="line">        amount = <span class="title function_">_getRate</span>(dstToken, srcToken) * targetAmount / <span class="number">1e6</span>;</span><br><span class="line">        emit <span class="title class_">MessageSent</span>(<span class="title class_">Message</span>(&#123;</span><br><span class="line">            <span class="attr">messageType</span>: <span class="title class_">MessageType</span>.<span class="property">LiquidityRequest</span>,</span><br><span class="line">            <span class="attr">from</span>: <span class="title function_">address</span>(<span class="variable language_">this</span>),</span><br><span class="line">            <span class="attr">receiver</span>: receiver,</span><br><span class="line">            <span class="attr">srcToken</span>: srcToken,</span><br><span class="line">            <span class="attr">dstToken</span>: dstToken,</span><br><span class="line">            <span class="attr">srcChainId</span>: block.<span class="property">chainid</span>,</span><br><span class="line">            <span class="attr">dstChainId</span>: block.<span class="property">chainid</span> == <span class="variable constant_">CODE_CHAIN</span> ? <span class="variable constant_">GATE_CHAIN</span> : <span class="variable constant_">CODE_CHAIN</span>,</span><br><span class="line">            <span class="attr">amount</span>: diffAmount</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">from</span> != <span class="title function_">address</span>(<span class="variable language_">this</span>)) &#123;</span><br><span class="line">        srcTokenAddress.<span class="title function_">transferFrom</span>(<span class="keyword">from</span>, <span class="title function_">address</span>(<span class="variable language_">this</span>), amount);</span><br><span class="line">    &#125;</span><br><span class="line">    dstTokenAddress.<span class="title function_">transfer</span>(receiver, targetAmount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There exists a small vuln in the cross-chain process. Before <code>DEX</code> initiates the request, it recalculates the <code>amount = _getRate(dstToken, srcToken) * targetAmount / 1e6</code> first. Due to integer division, this may cause a loss of precision. If the <code>targetAmount</code> is accurately controlled, we can set <code>amount</code> to 0 and get paid for free.</p>
<p>Therefore, we control the number of <code>tokenA/B/C</code> first through the exchange service, and then trigger this vuln via a cross-chain request. By repeating this process several times we can solve this challenge. –&gt;</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/links/">Links</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#LEAk-12-solves"><span class="toc-number">1.</span> <span class="toc-text">LEAk (12 solves)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smartLock-10-solves"><span class="toc-number">2.</span> <span class="toc-text">smartLock (10 solves)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#In-Korea"><span class="toc-number">3.</span> <span class="toc-text">In Korea</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://rechn0.github.io/2025/07/14/codegatectffinal2025/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&text=Codegate CTF 2025 Final"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&is_video=false&description=Codegate CTF 2025 Final"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Codegate CTF 2025 Final&body=Check out this article: http://rechn0.github.io/2025/07/14/codegatectffinal2025/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&title=Codegate CTF 2025 Final"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&name=Codegate CTF 2025 Final&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://rechn0.github.io/2025/07/14/codegatectffinal2025/&t=Codegate CTF 2025 Final"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2025
    rec
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/links/">Links</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?8411e09da389ccf9ca0908e876ad4d4d";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
