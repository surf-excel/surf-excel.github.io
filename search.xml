<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>BlackHat MEA CTF 2025 Final (Riyadh, Saudi Arabiaüá∏üá¶)</title>
    <url>/2025/12/09/blackhatmeactffinal2025/</url>
    <content><![CDATA[<p>Time: 2025.12.02-04 (onsite)</p>
<p>So, first time leaving my country and its for a CTF. Literally packed my bags, thought I'm a world traveler now. Arrived in Riyadh, Saudi Arabia with team ===___=== (yeah thats really my team name haha..).</p>
<p>Three days of sleepless nights, lots of soft drinks, and questionable life choices later we somehow managed to get 12th place . Not too shabby for someone who barely knows how to use Google Maps. GG to my teammates who actually know what they're doing!</p>
<p><img src="/2025/12/09/blackhatmeactffinal2025/images/scoreboard.png" alt="scoreboard"></p>
<p><img src="/2025/12/09/blackhatmeactffinal2025/images/scoreboard2.png" alt="scoreboard2"></p>
<h1 id="day1"><a href="#day1" class="headerlink" title="day1"></a>day1</h1><h2 id="Que"><a href="#Que" class="headerlink" title="Que?"></a>Que?</h2><ul>
<li><a href="day1/que/que.py">que.py</a></li>
</ul>
<p>I was looking at this challenge and at first it felt complex‚Äîlots of math, custom crypto, big primes. But once I slowed down, mistake jumped out.

Both secrets (k and r) are multiplied by same small 24-bit mask. When protocol computes C1 = k ¬∑ r‚Åª¬π mod p, that mask cancels out completely. So "128-bit secret" isn't really 128 bits anymore.

The bigger facepalm? Aaron encrypts flag before protocol even finishes. No authentication. No confirmation. Just straight AES-ECB with a deterministic key and a known flag format. That makes offline guessing trivial.</p>
<h2 id="Tampering-Detection-System"><a href="#Tampering-Detection-System" class="headerlink" title="Tampering Detection System"></a>Tampering Detection System</h2><ul>
<li><a href="day1/TDS/server.py">server.py</a></li>
</ul>
<h3 id="AES-GCM"><a href="#AES-GCM" class="headerlink" title="AES-GCM"></a>AES-GCM</h3><p><img src="/2025/12/09/blackhatmeactffinal2025/images/aes_gcm.png" alt="aes-gcm"></p>
<p>Some code by me for a better understanding. (I prefer $E_0$ while it's $J_0$ in figure.)</p>
<h3 id="GCM-Routine"><a href="#GCM-Routine" class="headerlink" title="GCM Routine"></a>GCM Routine</h3><p>As always, we need to recover <code>(H, E0)</code> first. We have: </p>
<ul>
<li><code>tag = GHASH(H, C) + E0</code></li>
<li><code>tag2 - tag1 = GHASH(H, C2) - GHASH(H, C1) = GHASH(H, xor(C2, C1))</code></li>
</ul>
<p>Then we can find the roots of the polynomial on GF, which includes <code>H</code>. We don't know <code>(ct1, ct2)</code> but for AES-GCM we have <code>xor(ct1, ct2) = xor(pt1, pt2)</code>, and <code>xor(C1, C2) = 0_128||xor(pt1, pt2)||0_64||0_64</code>.</p>
<p>With <code>H</code>, we can solve <code>E0 = tag_flag - GHASH(H, C_flag)</code>, thus enabling us to forge a valid tag for any ciphertext.</p>
<h3 id="AAD-Construction"><a href="#AAD-Construction" class="headerlink" title="AAD Construction"></a>AAD Construction</h3><p>In the second part we're given a decryption oracle, requiring truncating <code>length</code> and <code>aad</code>. Our target is to recover <code>ct</code> and decrypt the flag.</p>
<p>One may notice that each <code>ct</code> corresponds to a unique <code>aad</code>, which can be solved from a linear equation on GF. Consider we have recovered <code>ct[:i]</code>, we can bruteforce <code>ct[:i+1] = ct[:i] + ch</code> and find the real <code>ch</code> by checking the corresponding <code>aad</code>, thus recovering <code>ct</code> byte by byte.</p>
<p>With a long enough <code>ct</code>, we can decrypt our flag now.</p>
<ul>
<li><a href="day1/TDS/exp.py">exp.py</a></li>
</ul>
<h1 id="day2"><a href="#day2" class="headerlink" title="day2"></a>day2</h1><h2 id="doloRSitAmet"><a href="#doloRSitAmet" class="headerlink" title="doloRSitAmet"></a>doloRSitAmet</h2><ul>
<li><a href="day2/doloRSitAmet/server.py">server.py</a></li>
</ul>
<h3 id="All-about-Sample-Strategy"><a href="#All-about-Sample-Strategy" class="headerlink" title="All about Sample Strategy"></a>All about Sample Strategy</h3><p>Clearly, 4 equations are not enough to solve the whole system, but we can 'glue' some variables by setting certain seeds. For instance we can fix <code>1,2</code> showing up together, which leads to a new variable.</p>
<p>At first I tried to split them into 3 parts like <code>[(0), (1,2,3), (4)]</code>.</p>
<p>With 4 equations we can obtain a linear equation of the form $a \cdot x + b \cdot y + c &#x3D; 0 \pmod{n}$. It's indeed solvable with LLL, but we need some (too much) luck to get <strong>2 small variables</strong>. This costed me a lot of time.</p>
<p>Then I realized if we glue 4 variables together, there's only 2 variables left in 2 equations, and we can obtain a univariate polynomial. Just do it twice:</p>
<p>With 2 polynomials, we can solve the first variable by <code>gcd</code>. This gives us another linear equation with 2 variables (the first sentence and the flag sentence) but much smaller (there's only 32 bytes unknown in the flag sentence), so we just LLL and get the flag.</p>
<ul>
<li><a href="day2/doloRSitAmet/exp.py">exp.py</a></li>
</ul>
<h2 id="limeade"><a href="#limeade" class="headerlink" title="limeade"></a>limeade</h2><ul>
<li><a href="day2/limeade/limeade.py">limeade.py</a></li>
</ul>
<p>A juicy challenge, for real.</p>
<h3 id="Structure-Analysis"><a href="#Structure-Analysis" class="headerlink" title="Structure Analysis"></a>Structure Analysis</h3><p>To put it briefly, <code>Lime</code> includes permutation (<code>Roll</code>) and substitution (<code>Squeeze</code>) funcion. And <code>Jucier</code> essentially constructs a 2-round SPN cipher with each round using the same key:</p>
<ol>
<li>permuted (lime[0]) key addition</li>
<li>16 times substitution (lime[1]) and permutation (lime[2])</li>
<li>permuted (lime[3]) key addition</li>
<li>16 times substitution (lime[4]) and permutation (lime[5])</li>
<li>permuted (lime[6]) key addition</li>
</ol>
<h3 id="Boomerang-Style-Attack"><a href="#Boomerang-Style-Attack" class="headerlink" title="Boomerang Style Attack"></a>Boomerang Style Attack</h3><p>We are provided Encryption/Decryption Oracle with <strong>additional</strong> fault injection on the key. But first let's think about what we can do with <strong>xor</strong> fault injection.</p>
<p>An interesting observation is that $P \oplus K &#x3D; (P \oplus 1) \oplus (K \oplus 1)$, so if we inject 1 bit fault on both the key and <strong>the plaintext</strong> at the same position, it shows no difference after the first round of encryption. But with the second key addition, the fault will be injected and the final ciphertext goes completely different.</p>
<p>Why don't we do it again? This time let's inject on both the key and <strong>the ciphertext</strong>, and do the decryption.</p>
<p>This means a lot: now we have a pair of $(P_0, P_0'')$ which only have 1 bit difference after the first round of encryption. Let take another step forward‚Ä¶</p>
<p>Finally, we manage to obtain a ciphertext with 1 bit difference compared to the original one. Based on this we can construct a distinguisher with our additional fault injection:</p>
<ol>
<li>Encrypt a random plaintext with the original key.</li>
<li>Inject 1 bit additional fault on the i-th bit of the key.</li>
<li>Obtain the magic ciphertext with 1 bit fault injected.</li>
</ol>
<p>If success, the additional fault on the i-th bit equals to a 1 bit xor fault. For most parts of the key, this implies the i-th bit is 0 (with high probability). Injection on the MSB may always cause 1 bit fault so we need to bruteforce it instead.</p>
<ul>
<li><a href="day2/limeade/exp.py">exp.py</a></li>
</ul>
<h2 id="ella"><a href="#ella" class="headerlink" title="(*)ella"></a>(*)ella</h2><ul>
<li><a href="day2/ella/ella.py">ella.py</a></li>
</ul>
<blockquote>
<p>No need for any paper, it's just parity statistics.</p>
</blockquote>
<p>I may spend more time on this challenge later.</p>
<h1 id="day3"><a href="#day3" class="headerlink" title="day3"></a>day3</h1><h2 id="NoisyChannel"><a href="#NoisyChannel" class="headerlink" title="NoisyChannel"></a>NoisyChannel</h2><ul>
<li><a href="day3/NoisyChannel/server.py">server.py</a></li>
</ul>
<h3 id="Our-Solution"><a href="#Our-Solution" class="headerlink" title="Our Solution"></a>Our Solution</h3><p>It turns out that <code>randbytes</code> is implemented with <code>getrandbits</code>, with MT19937 as the prng core.</p>
<p>Our target is to find a kernel vector that can be used for any random seeds. If this is even possible, it implies we are dealing with a non-full-rank linear system. Therefore, we can randomly generate sets of data, concatenate them, and then extract a non-trivial vector from its left kernel space as the answer.</p>
<ul>
<li><a href="day3/NoisyChannel/exp.py">exp.py</a></li>
</ul>
<h2 id="LCC-LLC"><a href="#LCC-LLC" class="headerlink" title="(*)LCC LLC"></a>(*)LCC LLC</h2><ul>
<li><a href="day3/lccllc/app.py">app.py</a></li>
<li><a href="day3/lccllc/crypto.py">crypto.py</a></li>
</ul>
<p>Here comes a McEliece challenge.</p>
<h3 id="Decode-Failure-Oracle"><a href="#Decode-Failure-Oracle" class="headerlink" title="Decode Failure Oracle"></a>Decode Failure Oracle</h3><p>The server uses McEliece to generate access tokens, and our target is to forge a valid token with admin privilege. </p>
<p>There's not so much we can do actually, since we're only provided with some partly controllable tokens (even without the public key). So sadly i couldn't able to solve this one :") </p>
<h1 id="In-Saudi-Arabia"><a href="#In-Saudi-Arabia" class="headerlink" title="In Saudi Arabia"></a>In Saudi Arabia</h1><p>Still can't believe we did it, my teammates are reewnat, tanskit from uzbekistan and kruknight from Egypt. Got some luck too I guess .</p>
<table>
<thead>
<tr>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/team1.jpeg" alt="team1"></th>
</tr>
</thead>
</table>
<p>Met so many old and new friends here, enjoyed.meet with some dream teams *0xA, r3kapig, bios, hacksec etc</p>
<p>But 3-day competition is really tiring and we didn't have so much or energy to travel around. Will do more exploitation in the city if I come next year.</p>
<table>
<thead>
<tr>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/team2.jpeg" alt="team2"></th>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/bhmea.jpeg" alt="bhmea"></th>
</tr>
</thead>
</table>
<p><img src="/2025/12/09/blackhatmeactffinal2025/images/2.jpeg" alt="2"></p>
<p><img src="/2025/12/09/blackhatmeactffinal2025/images/3.jpeg" alt="3"></p>
<p><img src="/2025/12/09/blackhatmeactffinal2025/images/4.jpeg" alt="4"></p>
<p><img src="/2025/12/09/blackhatmeactffinal2025/images/5.jpeg" alt="5"></p>
]]></content>
      <tags>
        <tag>AES</tag>
        <tag>SPN</tag>
        <tag>McEliece</tag>
      </tags>
  </entry>
</search>
