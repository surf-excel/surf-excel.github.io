<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>XCTF-ACTF 2025</title>
    <url>/2025/04/27/actf2025/</url>
    <content><![CDATA[<p>Time: 2025.04.26-27 (online)</p>
<p>I played XCTF-ACTF 2025 with N0wayBack this weekend, and we got 1st for the first time. My teammates are sooooo strong orz</p>
<p><img src="/2025/04/27/actf2025/images/rank.png" alt="rank.png"></p>
<p>I with @Á≥ñÈÜãÂ∞èÈ∏°Âùó solved all 4 crypto challenges. All of them are high-quality, and we actually found many interesting unintended solutions XD</p>
<h2 id="easy-log-12-solves"><a href="#easy-log-12-solves" class="headerlink" title="easy_log (12 solves)"></a>easy_log (12 solves)</h2><blockquote>
<ul>
<li><a href="eazy_log/task.py">task.py</a></li>
</ul>
</blockquote>
<p>Yet another DLP challenge. </p>
<h3 id="Our-Solution"><a href="#Our-Solution" class="headerlink" title="Our Solution"></a>Our Solution</h3><p>At first glance this‚Äôs a classic curve problem, so we need to recover the curve first. We (@Á≥ñÈÜãÂ∞èÈ∏°Âùó) tried <a href="https://affine.group/writeup/2024-12-hxp-AlcoholicVariety">an interesting method</a> from @hellman. In this method we take many points as inputs and try to solve the curve parameters by polynomial interpolation. </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line">R, (x, y) = GF(p)[<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>].objgens() <span class="comment"># try on each p, since we need to compute kernel basis</span></span><br><span class="line">xt, yt = <span class="number">2</span>, <span class="number">2</span></span><br><span class="line"></span><br><span class="line">monomials = [x**i*y**j <span class="keyword">for</span> i, j <span class="keyword">in</span> product(<span class="built_in">range</span>(xt+<span class="number">1</span>), <span class="built_in">range</span>(yt+<span class="number">1</span>))]</span><br><span class="line">kG2 = [double_and_add(randint(<span class="number">0</span>, p), G2, p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(monomials)+<span class="number">1</span>)]</span><br><span class="line">A = matrix(GF(p), [[monomial(x, y) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials] <span class="keyword">for</span> x, y <span class="keyword">in</span> kG2])</span><br><span class="line">coefs = A.right_kernel().basis()</span><br><span class="line"><span class="keyword">for</span> coef <span class="keyword">in</span> coefs:</span><br><span class="line">	f = <span class="built_in">sum</span>([fi*monomial <span class="keyword">for</span> fi, monomial <span class="keyword">in</span> <span class="built_in">zip</span>(coef, monomials)])</span><br><span class="line">	<span class="built_in">print</span>(coef)</span><br><span class="line">	<span class="built_in">print</span>(f)</span><br></pre></td></tr></table></figure>

<p>And this is a universal method, you just need to pre-assume the monomials. We managed to recover the curve as $x^2 + x \cdot y - y^2 + 1 &#x3D; 0$ with <code>G2</code>, but IT DIDN‚ÄôT WORK ON <code>G1</code>! (And this will be discussed later)</p>
<p>Now this is a quadratic curve (a conic curve actually), and the order of the curve on $\mathbb{F_p}$ should be $p^2-1$. With some tests, this worked on both <code>G1</code> and <code>G2</code>. Based on this we can implement a PH-BSGS style attack to solve DLP.</p>
<p>For the first part, we factor the given $n$.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">0x231d5fa471913e79facfd95e9b874e2d499def420e0914fab5c9f87e71c2418d1194066bd8376aa8f02ef35c1926f73a46477cd4a88beae89ba575bb3e1b04271426c6706356dd8cd9aa742d7ad0343f8939bfd2110d45122929d29dc022da26551e1ed7000</span></span><br><span class="line">ps = [</span><br><span class="line">    (<span class="number">2</span>, <span class="number">12</span>),</span><br><span class="line">    (<span class="number">5</span>, <span class="number">4</span>),</span><br><span class="line">    (<span class="number">15271784978279</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">10714146599832792643</span>, <span class="number">1</span>), </span><br><span class="line">    (<span class="number">222696442740376752383</span>, <span class="number">3</span>), </span><br><span class="line">    (<span class="number">899889935029682511225429150065010811552017719005924136271659168643090431</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">899889935029682511225429150065010811552017719005924136271659166808024139</span>, <span class="number">1</span>)</span><br><span class="line">]</span><br><span class="line"><span class="keyword">assert</span> n == prod([p**i <span class="keyword">for</span> p, i <span class="keyword">in</span> ps])</span><br></pre></td></tr></table></figure>

<p>It turns out each factor is appropriate for the attack (note that the order on some certain primes are $p-1$). To recover the secret (8*68&#x3D;544bit), we also used p-adic field attack on <code>(222696442740376752383, 3)</code>. Somehow I could only solve it on $p^2$ instead of $p^3$, but that was enough.</p>
<p>For the second part, we just constructed a smooth prime with several 16bit subgroups. </p>
<blockquote>
<p>solution: <a href="eazy_log/exp.py">exp.py</a></p>
</blockquote>
<p>Definitely not a pleasing code, but we have a worse one during the contest.</p>
<h3 id="Some-Additional-Thoughts"><a href="#Some-Additional-Thoughts" class="headerlink" title="Some Additional Thoughts"></a>Some Additional Thoughts</h3><p>So far it‚Äôs enough to solve the challenge. We don‚Äôt need the curve itself, we just need the order actually. But it‚Äôs really weird that <code>G1</code> is not on the curve (not on any curve ig, considering @hellman‚Äôs method is universal), but has the same structure.</p>
<p>After the contest I got the answer from @‚àù: this is not a curve operation but a matrix operation. </p>
<p>$$<br>\begin{bmatrix}<br>y_3-x_3 &amp; x_3 \\<br>x_3 &amp; y_3<br>\end{bmatrix}&#x3D;<br>\begin{bmatrix}<br>y_2-x_2 &amp; x_2 \\<br>x_2 &amp; y_2<br>\end{bmatrix}<br>\cdot<br>\begin{bmatrix}<br>y_1-x_1 &amp; x_1 \\<br>x_1 &amp; y_1<br>\end{bmatrix}<br>$$</p>
<p>This forms a multiplication matrix group. And when the elements satisfy the curve equation, it becomes isomorphic to the addition curve group. But the operation itself doesn‚Äôt need the element to be a curve point. And now it‚Äôs quite clear. We can analyze the eigenvalues or the group itself to get the order. With the eigenvalues we can also map the elements onto $\mathbb{F_p^2}$, gaining some optimization to solve DLP.</p>
<p>Since this is not my first time to connect matrixs and quadratic curves, I may find some time to give a comprehensive learning these days. And we still need some math works on how to solve such DLP on $p^i$.</p>
<h2 id="AAALLL-8-solves"><a href="#AAALLL-8-solves" class="headerlink" title="AAALLL (8 solves)"></a>AAALLL (8 solves)</h2><blockquote>
<ul>
<li><a href="AAALLL/task.sage">task.sage</a></li>
</ul>
</blockquote>
<p>In this challenge we need to find a $n$-degree small ternary polynomial $f$, with $\frac{n}{2}$ pairs of $(x_i, f(x_i))$ on $\mathbb{F_p}$. The special part is that $x_i$ is randomly picked from the roots of $x^n+1$. Here $n&#x3D;450$ and $pbit&#x3D;32$.</p>
<h3 id="Solution-1-Unintended"><a href="#Solution-1-Unintended" class="headerlink" title="Solution 1 (Unintended)"></a>Solution 1 (Unintended)</h3><p>A direct way is to construct the primal lattice and solve $f$ with <code>flatter</code>. The main reason this worked is $pbit&#x3D;32$ is a little big for $n&#x3D;450$, and it‚Äôs enough to solve uSVP under BKZ-2 bound. One can pick a subset of the instances to get a better perfomance.</p>
<h3 id="Solution-2-Intended"><a href="#Solution-2-Intended" class="headerlink" title="Solution 2 (Intended)"></a>Solution 2 (Intended)</h3><p>The intended solution captures the special structure of the lattice. Since $x_i$ is a root of $x^n+1$, we‚Äôre actually dealing with a subset of Vandermonde matrix columns. This is called Partial Vandermonde Knapsack Problem, and you can find a optimized solution in <a href="https://eprint.iacr.org/2024/366">this</a> from Eurocrypt 2024.</p>
<p><img src="/2025/04/27/actf2025/images/pvkp.png" alt="pvkp.png"></p>
<p>To make it clear, we have $x^n + 1 &#x3D; 0 \rightarrow \frac{1}{x} &#x3D; -x^{n-1} \pmod{p}$, and this builds certain connections between $f(x)$ and $f(\frac{1}{x})$. For instance, we have $f(x) &#x3D; a_{n-1} \cdot x^{n-1} + ‚Ä¶$ and $f(\frac{1}{x}) &#x3D; a_1 \cdot \frac{1}{x} + ‚Ä¶$, and we can sum them up to get $f(x) + f(\frac{1}{x}) &#x3D; (a_{n-1}-a_1) \cdot x^{n-1} + ‚Ä¶$.</p>
<p>In short, we can construct new polynomials $(\phi_+(x), \phi_-(x))$ with $(f(x), f(\frac{1}{x}))$, where $(\phi_+(x), \phi_-(x))$ are small and can be generated with a shorter (about $\lfloor \frac{n}{2} \rfloor$) basis. The following code gives a better explanation.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_ternery_poly</span>(<span class="params">Q</span>):</span><br><span class="line">    <span class="keyword">return</span> Q([choice([-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree())])</span><br><span class="line"></span><br><span class="line">n = <span class="number">450</span></span><br><span class="line">p = <span class="number">3774877201</span></span><br><span class="line">t = n//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">P, x = GF(p)[<span class="string">&quot;x&quot;</span>].objgen()</span><br><span class="line">g = x**n+<span class="number">1</span></span><br><span class="line">roots = [i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> g.roots()]</span><br><span class="line">Q = P.quotient(g)</span><br><span class="line"></span><br><span class="line">f = sample_ternery_poly(Q).lift()</span><br><span class="line">rs = <span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> roots:</span><br><span class="line">    <span class="keyword">if</span> r <span class="keyword">not</span> <span class="keyword">in</span> rs <span class="keyword">and</span> <span class="number">1</span>/r <span class="keyword">not</span> <span class="keyword">in</span> rs:</span><br><span class="line">        rs.append(r)</span><br><span class="line"></span><br><span class="line">xs = [[r**i + <span class="number">1</span>/r**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n//<span class="number">2</span>+<span class="number">1</span>)] <span class="keyword">for</span> r <span class="keyword">in</span> rs]</span><br><span class="line">ys = [f(r) + f(<span class="number">1</span>/r) <span class="keyword">for</span> r <span class="keyword">in</span> rs]</span><br><span class="line"><span class="built_in">print</span>(matrix(GF(p), xs).solve_right(vector(ys)))</span><br><span class="line"></span><br><span class="line">xs = [[r**i - <span class="number">1</span>/r**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n//<span class="number">2</span>+<span class="number">1</span>)] <span class="keyword">for</span> r <span class="keyword">in</span> rs]</span><br><span class="line">ys = [f(r) - f(<span class="number">1</span>/r) <span class="keyword">for</span> r <span class="keyword">in</span> rs]</span><br><span class="line"><span class="built_in">print</span>(matrix(GF(p), xs).solve_right(vector(ys)))</span><br></pre></td></tr></table></figure>

<p>With high possibility, we can find some pairs of $(f(x), f(\frac{1}{x}))$ from the given data. Then we can solve $(\phi_+, \phi_-)$ from two smaller primal lattices and combine them to get the original polynomial $f$. </p>
<h2 id="OhMyTetration-8-solves"><a href="#OhMyTetration-8-solves" class="headerlink" title="OhMyTetration (8 solves)"></a>OhMyTetration (8 solves)</h2><blockquote>
<ul>
<li><a href="OhMyTetration/task.py">task.py</a></li>
</ul>
</blockquote>
<p>Here is a lottery center with some secret code in <code>lotteryCenter</code>. In short, we can send some $(g, times)$ to the server and receive a tetration $\mathcal{T}(p, g, x, times)$. For instance, $\mathcal{T}(p, g, x, 2) &#x3D; g^{g^x} \pmod{p}$. And our target is to recover $x$.</p>
<h3 id="Some-Fuzzes"><a href="#Some-Fuzzes" class="headerlink" title="Some Fuzzes"></a>Some Fuzzes</h3><p>It turns out that each time the server randomly chooses a prime $p$ from a small prime set. Take one of them as an example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p =¬†<span class="number">1502305675703953507826564356364207463785905265358954425050832597353379827611347779894929874274487297076504174110953417469304402049079223143080164648064147459</span></span><br><span class="line">q = (p -¬†<span class="number">1</span>) //¬†<span class="number">2</span></span><br><span class="line">qs = [(<span class="number">2</span>,¬†<span class="number">12</span>), (<span class="number">2449952539</span>,¬†<span class="number">1</span>), (<span class="number">2580715139</span>,¬†<span class="number">1</span>), (<span class="number">2792523953</span>,¬†<span class="number">1</span>), (<span class="number">2945474351</span>,¬†<span class="number">1</span>), (<span class="number">2996317717</span>,¬†<span class="number">1</span>), (<span class="number">3172879987</span>,¬†<span class="number">1</span>), (<span class="number">3229817321</span>,¬†<span class="number">1</span>), (<span class="number">3272969519</span>,¬†<span class="number">1</span>), (<span class="number">3435471803</span>,¬†<span class="number">1</span>), (<span class="number">3606091481</span>,¬†<span class="number">1</span>), (<span class="number">3613773421</span>,¬†<span class="number">1</span>), (<span class="number">3696075863</span>,¬†<span class="number">1</span>), (<span class="number">3706535681</span>,¬†<span class="number">1</span>), (<span class="number">3729911617</span>,¬†<span class="number">1</span>), (<span class="number">3912962413</span>,¬†<span class="number">1</span>), (<span class="number">3919762169</span>,¬†<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">assert</span>¬†q == prod(qi**i¬†<span class="keyword">for</span>¬†qi, i¬†<span class="keyword">in</span>¬†qs) +¬†<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>Here $p &#x3D; 2*q + 1$, where $q$ is another big prime and $q-1$ is very smooth. All other $p$ have the same structure so we can just use this one in the following steps. To achieve that in the code, I just kept reconnecting until the server chose my prime.</p>
<p>Another point worth noting is that we cannot just choose $g$ arbitrarily because of <code>lotteryCenter.defineG(g)</code>. After some tests, we found that some certain primes can pass the check. While it doesn‚Äôt expose the underlying checking strategy, we still have the opportunity to get a valid one by keeping constructing some primes.</p>
<h3 id="Solution-1-Unintended-1"><a href="#Solution-1-Unintended-1" class="headerlink" title="Solution 1 (Unintended)"></a>Solution 1 (Unintended)</h3><p>Considering $q-1$ is smooth, with several 32bit small primes, a PH-BSGS style attack works as:</p>
<ol>
<li>Choose a generator $g_i$ from the $q_i$-order subgroup of $\mathbb{F_q}$, here we have $q_i | (q-1)$.</li>
<li>Receive $y &#x3D; \mathcal{T}(p, g_i, x, 2) &#x3D; g_i^{g_i^x} \pmod{p}$ from the server.</li>
<li>For all $a \in [0, t]$, compute and store $g_i^{2 \cdot g^{a \cdot t} \pmod{q}} \pmod{p}$.</li>
<li>For all $b \in [0, t]$, compute $y^{2 \cdot g_i^{-b} \pmod{q}} \pmod{p}$ and query for a corresponding $a$.</li>
<li>Finally, we have $x &#x3D; a \cdot t + b \pmod{q_i}$, and we can combine them using <code>crt</code>.</li>
</ol>
<p>Here we choose $t &#x3D; \lceil \sqrt{q_i} \rceil$ for a balanced perfomance. You can check the correctnest by $y^{g_i^{-b}} &#x3D; g_i^{g_i^{x-b}} &#x3D; g_i^{g_i^{a \cdot t}}\pmod{p}$. The reason we need $g_i^{2 \cdot (‚Ä¶)} \pmod{p}$ instead of $g_i^{(‚Ä¶)} \pmod{p}$ is that the order of $g_i$ may be $p-1 &#x3D; 2 \cdot q$ on $\mathbb{F_p}$, where the order of $g_i^2 \pmod{p}$ is guaranteed to be $q$ (or 1, with negligible probability).</p>
<p>That‚Äôs it. What we need to do is to find a valid prime generator $g_i$, get a piece of $x_i$ locally, and then recover $x \pmod{\frac{q-1}{2}}$ with <code>crt</code>. For this chall, we need a little bruteforce to get the real $x &#x3D; (x \pmod{\frac{q-1}{2}}) + k \cdot \frac{q-1}{2}$.</p>
<blockquote>
<ul>
<li>solution: <a href="OhMyTetration/exp.py">exp.py</a></li>
</ul>
</blockquote>
<p>It actually costed us plenty of time since <code>lotteryCenter.defineG(g)</code> is veryyyyy slow, somehow :o</p>
<h3 id="Solution-2-Intended-1"><a href="#Solution-2-Intended-1" class="headerlink" title="Solution 2 (Intended)"></a>Solution 2 (Intended)</h3><p>For the intended solution, we need more complex tetrations. As we compute a ‚Äúhigher‚Äù tetration tower, the order decreases rapidly as $\phi(\phi(‚Ä¶\phi(p)))$ where $\phi(x)$ is the Euler function. With an appropriate order, we can bruteforce the solution and a piece of $x$ under some modulus.</p>
<p>This is more complicated. But if the level of tetration got limited or $q-1$ was not that smooth, we might have to try this ig.</p>
<h2 id="tinyCKKS-2-solves"><a href="#tinyCKKS-2-solves" class="headerlink" title="tinyCKKS (2 solves)"></a>tinyCKKS (2 solves)</h2><blockquote>
<ul>
<li><a href="tinyCKKS/main.sage">main.sage</a> # task file</li>
<li><a href="tinyCKKS/ckks.sage">ckks.sage</a> # ckks main class</li>
<li><a href="tinyCKKS/ciphertext.sage">ciphertext.sage</a> # ct class</li>
<li><a href="tinyCKKS/poly.sage">poly.sage</a> # poly class</li>
<li><a href="tinyCKKS/gadget.sage">gadget.sage</a> # ckks gadget function</li>
<li><a href="tinyCKKS/distribution.sage">distribution.sage</a> # ckks distribution function</li>
<li><a href="tinyCKKS/module_test.sage">module_test.sage</a> # module test</li>
</ul>
</blockquote>
<p>A good chance to learn more about FHE-CKKS! Nice code from @den.g_feng :D</p>
<h3 id="CKKS-Intro"><a href="#CKKS-Intro" class="headerlink" title="CKKS: Intro"></a>CKKS: Intro</h3><p>In CKKS we deal with polynomials on a quotient ring with a prime power modulus $q&#x3D;p^i$. At first the modulus is $p^{L+1}$. In general, CKKS is a RLWE style FHE scheme.</p>
<ul>
<li>$\mathcal{Keygen}$: Generate a secret ternary polynomial $sk$.</li>
<li>$\mathcal{Encode}$: For message polynomial $m$, compute $pt_i &#x3D; \lfloor m_i \cdot p \rfloor$ and construct the plaintext polynomial $pt$.</li>
<li>$\mathcal{Decode}$: Compute $m_i &#x3D; \frac{pt_i}{p}$ to recover the original $m$.</li>
<li>$\mathcal{Enc}$: For the plaintext polynomial $pt$, sample a noise polynomial $e$ and a random polynomial $ct_0$. Then compute $ct_1 &#x3D; pt + e - ct_0 \cdot sk$, and the ciphertext pair is $(ct_0, ct_1)$.</li>
<li>$\mathcal{Dec}$ Compute $pt‚Äô &#x3D; ct_1 + ct_0 \cdot sk$.</li>
</ul>
<p>In this challenge we use a simpler encode&#x2F;decode strategy, the original CKKS scheme involves complex number and some other complicated operations.</p>
<p>It‚Äôs important to know that CKKS handles float data, which means $m$ is a float sequence (but $pt$ and other parts are not). You can find out that we actually cannot recover the original $pt$ and $m$ in CKKS. The noise is retained and after decoding, it exists as a small error in $m$.</p>
<h3 id="Solution-1-Intended"><a href="#Solution-1-Intended" class="headerlink" title="Solution 1 (Intended)"></a>Solution 1 (Intended)</h3><p>In this challenge our target is to submit the <strong>exact</strong> original <code>plain</code>.</p>
<p>The intended solution uses an interesting feature about CKKS, which may be counter-intuitive to FHE newbies (me). By encoding the decrypted <code>plain</code> again, we can recover the exact $pt + e$, and then we can recover $sk$ with the ciphtext pair $ct$.</p>
<p>I‚Äôm not sure about other FHE schemes but for CKKS, it‚Äôs <strong>NOT</strong> a secure option to open a decryption oracle. I think the main reason is that CKKS uses floats instead of integers.</p>
<blockquote>
<p>At least in this challenge it‚Äôs true. I heard a patched version is available in industrial implementations. </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">load(<span class="string">&quot;ckks.sage&quot;</span>)</span><br><span class="line"></span><br><span class="line">N = <span class="number">1024</span></span><br><span class="line">p = <span class="number">947819</span></span><br><span class="line">B = <span class="number">2</span></span><br><span class="line">L = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">r = <span class="number">10</span></span><br><span class="line">precision = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">ckks = tinyCKKS(N, p, B, L, debug)</span><br><span class="line">plain = [<span class="built_in">round</span>(np.random.uniform(<span class="number">0</span>, r), precision) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line">pt = ckks.encode(plain)</span><br><span class="line">ct = ckks.encrypt(pt)</span><br><span class="line">pt = ckks.decrypt(ct)</span><br><span class="line">plain = ckks.decode(pt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recover sk</span></span><br><span class="line">P, z = GF(p)[<span class="string">&quot;z&quot;</span>].objgen()</span><br><span class="line">Q = P.quotient_ring(z**N+<span class="number">1</span>)</span><br><span class="line">pt = ckks.encode(plain)</span><br><span class="line">sk = Q((pt - ct.b).poly.<span class="built_in">list</span>()) / Q(ct.a.poly.<span class="built_in">list</span>())</span><br><span class="line"><span class="keyword">assert</span> P(sk.<span class="built_in">list</span>()) == P(ckks.sk.poly.<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment"># recover e</span></span><br><span class="line">plain = [<span class="built_in">round</span>(np.random.uniform(<span class="number">0</span>, r), precision) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line">pt = ckks.encode(plain)</span><br><span class="line">ct = ckks.encrypt(pt)</span><br><span class="line">e = ct.b + ckks.sk*ct.a - pt</span><br><span class="line">e = [ZZ(_+p//<span class="number">2</span>)%p - p//<span class="number">2</span> <span class="keyword">for</span> _ <span class="keyword">in</span> e.poly.<span class="built_in">list</span>()]</span><br><span class="line"><span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>

<p>Remember our target is to submit the orignial <code>plain</code>, so we need to predict $e$ too. Since the server uses a sequence of consecutive <code>getrandbits(4)</code> to generate $e$, we can crack MT19937 with the current $e$ and predict the next one. And the solution is quite clear now: </p>
<ol>
<li>(<code>c=1</code>) Get any plaintext-ciphertext pair as your wish, recover $sk$.</li>
<li>(<code>c=2</code>) Get a ciphertext and the original <code>plain</code>, use $sk$ to recover $e$.</li>
<li>Recover the underlying MT19937 states and predict the next $e$.</li>
<li>(<code>c=3</code>) Get a ciphertext, use $sk$ and $e$ to recover the orignal <code>plain</code>.</li>
</ol>
<p>It‚Äôs worth mentioning that the noise is kinda too small compared to $p$ (you can find it out in <code>module_test</code>, the error between the original <code>plain</code> and the decrypted one is quite small). So it‚Äôs also feasible to eliminate the effect of the noise by controlling the precision of the <code>plain</code> (thanks to @hash_hash).</p>
<h3 id="Solution-2-Unintended"><a href="#Solution-2-Unintended" class="headerlink" title="Solution 2 (Unintended)"></a>Solution 2 (Unintended)</h3><p>My teammate @Á≥ñÈÜãÂ∞èÈ∏°Âùó found an interesting vuln about MT19937. Another PRNG used in this challenge is <code>np.random</code>, which is also based on MT19937 (in certain versions maybe).</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># distribution.sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_uniform_poly</span>(<span class="params">Q</span>):</span><br><span class="line">    q = Q.base_ring().cardinality()</span><br><span class="line">    N = Q.degree()</span><br><span class="line">    <span class="keyword">return</span> polynomial(q, N, Q([np.random.choice([-<span class="number">1</span>, <span class="number">1</span>]) * randbelow(<span class="built_in">int</span>(q//<span class="number">2</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree())]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_ternery_poly</span>(<span class="params">Q</span>):</span><br><span class="line">    q = Q.base_ring().cardinality()</span><br><span class="line">    N = Q.degree()</span><br><span class="line">    <span class="keyword">return</span> polynomial(q, N, Q([np.random.choice([-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree())]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># main.sage</span></span><br><span class="line">plain = [<span class="built_in">round</span>(np.random.uniform(<span class="number">0</span>, r), precision) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br></pre></td></tr></table></figure>

<p>While <code>sample_ternery_poly</code> and <code>plain</code> may not be accessible, we can get <code>sample_uniform_poly</code> from <code>ct_0</code> (and somewhere else), and it turns out we can obtain <code>np.random.choice([-1, 1])</code> from the signs of the coefficients. </p>
<p>Only with enough (say 19937bits) consecutive values of <code>np.random.choice([-1, 1])</code> can we recover the underlying states. So instead of <code>ct</code>, we need to use <code>gen_ksk</code> or <code>gen_relin_key</code> which gives <code>t</code> sets of ciphtertext-like data. Here <code>t=100</code> is big so we can get enough data in one shot. Here is how we solved it:</p>
<ol>
<li>(<code>c=1</code> and <code>ccc=3 or 4</code>) Get <code>t</code> sets of <code>sample_uniform_poly</code> data through <code>ksk</code> or <code>galois_key</code> (you can also use <code>relin_key</code> in <code>ccc=2</code>, which may be more complicated to implement). </li>
<li>Recover the underlying MT19937 states and predict the next <code>plain</code> (you can also predict <code>sample_ternery_poly</code> to get the next $e$).</li>
</ol>
<p>We actually thought this is the intended solution since it could use <code>randbelow(q)</code> in <code>sample_uniform_poly</code>. And <code>B</code> is very small to <code>q</code> so <code>t</code> is big enough here, but in <code>module_test</code> we have <code>B=2^8</code>.</p>
]]></content>
      <tags>
        <tag>LLL</tag>
        <tag>FHE</tag>
      </tags>
  </entry>
  <entry>
    <title>BlackHat MEA CTF 2025 Final (Riyadh, Saudi Arabiaüá∏üá¶)</title>
    <url>/2025/12/09/blackhatmeactffinal2025/</url>
    <content><![CDATA[<p>Time: 2025.12.02-04 (onsite)</p>
<p>I attended the Black Hat MEA CTF 2025 Final with r3kapig in Riyadh, Saudi Arabia.</p>
<p>After three days working we got the 2nd place ü•à in the competition, GG to all my teammates!</p>
<p><img src="/2025/12/09/blackhatmeactffinal2025/images/scoreboard.png" alt="scoreboard"></p>
<h1 id="day1"><a href="#day1" class="headerlink" title="day1"></a>day1</h1><h2 id="Que"><a href="#Que" class="headerlink" title="Que?"></a>Que?</h2><blockquote>
<ul>
<li><a href="day1/que/que.py">que.py</a></li>
</ul>
</blockquote>
<p>@chatgpt didn‚Äôt get a chance to take a look. XD</p>
<h2 id="Tampering-Detection-System"><a href="#Tampering-Detection-System" class="headerlink" title="Tampering Detection System"></a>Tampering Detection System</h2><blockquote>
<ul>
<li><a href="day1/TDS/server.py">server.py</a></li>
</ul>
</blockquote>
<h3 id="AES-GCM"><a href="#AES-GCM" class="headerlink" title="AES-GCM"></a>AES-GCM</h3><p><img src="/2025/12/09/blackhatmeactffinal2025/images/aes_gcm.png" alt="aes-gcm"></p>
<p>Some code by me for a better understanding. (I prefer $E_0$ while it‚Äôs $J_0$ in the figure.)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> GF</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">z0 = GF(<span class="number">2</span>)[<span class="string">&quot;z0&quot;</span>].gen()</span><br><span class="line">F, z = GF(<span class="number">2</span>**<span class="number">128</span>, name=<span class="string">&quot;z&quot;</span>, modulus=z0**<span class="number">128</span> + z0**<span class="number">7</span> + z0**<span class="number">2</span> + z0 + <span class="number">1</span>).objgen()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([ai^bi <span class="keyword">for</span> ai, bi <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad128</span>(<span class="params">pt</span>):</span><br><span class="line">    <span class="keyword">return</span> pt + <span class="string">b&#x27;\x00&#x27;</span> * ((<span class="number">16</span> - <span class="built_in">len</span>(pt))%<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">len64</span>(<span class="params">pt</span>):</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(<span class="built_in">len</span>(pt)*<span class="number">8</span>, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b2gf</span>(<span class="params">b</span>):</span><br><span class="line">    <span class="keyword">return</span> F(<span class="built_in">list</span>(<span class="built_in">bin</span>(bytes_to_long(b))[<span class="number">2</span>:].zfill(<span class="number">128</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gf2b</span>(<span class="params">g</span>):</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, g.<span class="built_in">list</span>())), <span class="number">2</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">TAG</span>(<span class="params">key: <span class="built_in">bytes</span>, aad: <span class="built_in">bytes</span>, nonce: <span class="built_in">bytes</span>, ct: <span class="built_in">bytes</span></span>):</span><br><span class="line">    aes = AES.new(key=key, mode=AES.MODE_ECB)</span><br><span class="line">    E0 = aes.encrypt(nonce + long_to_bytes(<span class="number">1</span>, <span class="number">4</span>))</span><br><span class="line">    H = aes.encrypt(long_to_bytes(<span class="number">0</span>, <span class="number">16</span>))</span><br><span class="line">    C = pad128(aad) + pad128(ct) + len64(aad) + len64(ct)</span><br><span class="line">    TAG = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(C), <span class="number">16</span>):</span><br><span class="line">        TAG += b2gf(C[i:i+<span class="number">16</span>])</span><br><span class="line">        TAG *= b2gf(H)</span><br><span class="line">    TAG += b2gf(E0)</span><br><span class="line">    <span class="keyword">return</span> gf2b(TAG) <span class="comment"># GHASH(H, C) + E0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CT</span>(<span class="params">key: <span class="built_in">bytes</span>, nonce: <span class="built_in">bytes</span>, pt: <span class="built_in">bytes</span></span>):</span><br><span class="line">    aes = AES.new(key=key, mode=AES.MODE_ECB)</span><br><span class="line">    H = aes.encrypt(long_to_bytes(<span class="number">0</span>, <span class="number">16</span>))</span><br><span class="line">    ctr = nonce + long_to_bytes(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">    ct = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(pt), <span class="number">16</span>):</span><br><span class="line">        ctr = long_to_bytes(bytes_to_long(ctr) + <span class="number">1</span>, <span class="number">16</span>)</span><br><span class="line">        pti = pt[i: i+<span class="number">16</span>]</span><br><span class="line">        cti = xor(pti, aes.encrypt(ctr)[:<span class="built_in">len</span>(pti)])</span><br><span class="line">        ct += cti</span><br><span class="line">    <span class="keyword">return</span> ct    </span><br></pre></td></tr></table></figure>

<h3 id="GCM-Routine"><a href="#GCM-Routine" class="headerlink" title="GCM Routine"></a>GCM Routine</h3><p>As always, we need to recover <code>(H, E0)</code> first. We have: </p>
<ul>
<li><code>tag = GHASH(H, C) + E0</code></li>
<li><code>tag2 - tag1 = GHASH(H, C2) - GHASH(H, C1) = GHASH(H, xor(C2, C1))</code></li>
</ul>
<p>Then we can find the roots of the polynomial on GF, which includes <code>H</code>. We don‚Äôt know <code>(ct1, ct2)</code> but for AES-GCM we have <code>xor(ct1, ct2) = xor(pt1, pt2)</code>, and <code>xor(C1, C2) = 0_128||xor(pt1, pt2)||0_64||0_64</code>.</p>
<p>With <code>H</code>, we can solve <code>E0 = tag_flag - GHASH(H, C_flag)</code>, thus enabling us to forge a valid tag for any ciphertext.</p>
<h3 id="AAD-Construction"><a href="#AAD-Construction" class="headerlink" title="AAD Construction"></a>AAD Construction</h3><p>In the second part we‚Äôre given a decryption oracle, requiring truncating <code>length</code> and <code>aad</code>. Our target is to recover <code>ct</code> and decrypt the flag.</p>
<p>One may notice that each <code>ct</code> corresponds to a unique <code>aad</code>, which can be solved from a linear equation on GF. Consider we have recovered <code>ct[:i]</code>, we can bruteforce <code>ct[:i+1] = ct[:i] + ch</code> and find the real <code>ch</code> by checking the corresponding <code>aad</code>, thus recovering <code>ct</code> byte by byte.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">z0 = GF(<span class="number">2</span>)[<span class="string">&quot;z0&quot;</span>].gen()</span><br><span class="line">F, z = GF(<span class="number">2</span>**<span class="number">128</span>, name=<span class="string">&quot;z&quot;</span>, modulus=z0**<span class="number">128</span> + z0**<span class="number">7</span> + z0**<span class="number">2</span> + z0 + <span class="number">1</span>).objgen()</span><br><span class="line">x = F[<span class="string">&quot;x&quot;</span>].gen()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    aad = <span class="string">b&quot;\x00&quot;</span>*<span class="number">16</span></span><br><span class="line">    ct = prefix + <span class="built_in">bytes</span>([ch])</span><br><span class="line">    C = pad128(aad) + pad128(ct) + len64(aad) + len64(ct)</span><br><span class="line">    ftag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(C), <span class="number">16</span>):</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            Ci = x</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Ci = b2gf(C[i: i+<span class="number">16</span>])</span><br><span class="line">        ftag += Ci</span><br><span class="line">        ftag *= b2gf(H)</span><br><span class="line">    ftag += b2gf(E0) + b2gf(tag2)</span><br><span class="line">    ans = ftag.univariate_polynomial().roots()</span><br><span class="line">    aad = gf2b(ans[<span class="number">0</span>][<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<p>With a long enough <code>ct</code>, we can decrypt our flag now.</p>
<blockquote>
<ul>
<li><a href="day1/TDS/exp.py">exp.py</a></li>
</ul>
</blockquote>
<h1 id="day2"><a href="#day2" class="headerlink" title="day2"></a>day2</h1><h2 id="doloRSitAmet"><a href="#doloRSitAmet" class="headerlink" title="doloRSitAmet"></a>doloRSitAmet</h2><blockquote>
<ul>
<li><a href="day2/doloRSitAmet/server.py">server.py</a></li>
</ul>
</blockquote>
<h3 id="All-about-Sample-Strategy"><a href="#All-about-Sample-Strategy" class="headerlink" title="All about Sample Strategy"></a>All about Sample Strategy</h3><p>Clearly, 4 equations are not enough to solve the whole system, but we can ‚Äòglue‚Äô some variables by setting certain seeds. For instance we can fix <code>1,2</code> showing up together, which leads to a new variable.</p>
<p>At first I tried to split them into 3 parts like <code>[(0), (1,2,3), (4)]</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Seed 15901 gives [0, 1, 2, 3, 4]</span><br><span class="line">Seed 22733 gives [4, 1, 2, 3, 0]</span><br><span class="line">Seed 15054 gives [1, 2, 3, 0, 4]</span><br><span class="line">Seed 17502 gives [1, 2, 3, 4, 0]</span><br></pre></td></tr></table></figure>

<p>With 4 equations we can obtain a linear equation of the form $a \cdot x + b \cdot y + c &#x3D; 0 \pmod{n}$. It‚Äôs indeed solvable with LLL, but we need some (too much) luck to get <strong>2 small variables</strong>. This costed me a lot of time.</p>
<p>Then I realized if we glue 4 variables together, there‚Äôs only 2 variables left in 2 equations, and we can obtain a univariate polynomial. Just do it twice:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Seed 15901 gives [0, 1, 2, 3, 4]</span><br><span class="line">Seed 17502 gives [1, 2, 3, 4, 0]</span><br><span class="line">Seed 4145  gives [0, 2, 3, 4, 5]</span><br><span class="line">Seed 15589 gives [2, 3, 4, 5, 0]</span><br></pre></td></tr></table></figure>

<p>With 2 polynomials, we can solve the first variable by <code>gcd</code>. This gives us another linear equation with 2 variables (the first sentence and the flag sentence) but much smaller (there‚Äôs only 32 bytes unknown in the flag sentence), so we just LLL and get the flag.</p>
<blockquote>
<ul>
<li><a href="day2/doloRSitAmet/exp.py">exp.py</a></li>
</ul>
</blockquote>
<h2 id="limeade"><a href="#limeade" class="headerlink" title="limeade"></a>limeade</h2><blockquote>
<ul>
<li><a href="day2/limeade/limeade.py">limeade.py</a></li>
</ul>
</blockquote>
<p>A juicy challenge, for real.</p>
<h3 id="Structure-Analysis"><a href="#Structure-Analysis" class="headerlink" title="Structure Analysis"></a>Structure Analysis</h3><p>To put it briefly, <code>Lime</code> includes permutation (<code>Roll</code>) and substitution (<code>Squeeze</code>) funcion. And <code>Jucier</code> essentially constructs a 2-round SPN cipher with each round using the same key:</p>
<ol>
<li>permuted (lime[0]) key addition</li>
<li>16 times substitution (lime[1]) and permutation (lime[2])</li>
<li>permuted (lime[3]) key addition</li>
<li>16 times substitution (lime[4]) and permutation (lime[5])</li>
<li>permuted (lime[6]) key addition</li>
</ol>
<h3 id="Boomerang-Style-Attack"><a href="#Boomerang-Style-Attack" class="headerlink" title="Boomerang Style Attack"></a>Boomerang Style Attack</h3><p>We are provided Encryption&#x2F;Decryption Oracle with <strong>additional</strong> fault injection on the key. But first let‚Äôs think about what we can do with <strong>xor</strong> fault injection.</p>
<p>An interesting observation is that $P \oplus K &#x3D; (P \oplus 1) \oplus (K \oplus 1)$, so if we inject 1 bit fault on both the key and <strong>the plaintext</strong> at the same position, it shows no difference after the first round of encryption. But with the second key addition, the fault will be injected and the final ciphertext goes completely different.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Encryption</span><br><span class="line">‚Üì   P0, K                   ‚Üí   P0+perm[0](1), K+1</span><br><span class="line"></span><br><span class="line">:   P0                      ‚Üí   P0+perm[0](1)</span><br><span class="line">‚Üìperm[0] key add</span><br><span class="line">:   P0+perm[0](K)           ‚Üí   P0+perm[0](1)+perm[0](K+1) = P0+perm[0](K)</span><br><span class="line">‚Üì16 sub[1]-perm[2]</span><br><span class="line">:   P1                      ‚Üí   P1</span><br><span class="line">‚Üìperm[3] key add</span><br><span class="line">:   P1+perm[3](K)           ‚Üí   P1+perm[3](K+1)</span><br><span class="line">‚Üì16 sub[4]-perm[5]</span><br><span class="line">:   P2                      ‚Üí   P2&#x27;</span><br><span class="line">‚Üìperm[6] key add</span><br><span class="line">:   P2+perm[6](K)           ‚Üí   P2&#x27;+perm[6](K+1)</span><br><span class="line"></span><br><span class="line">=   P2+perm[6](K)           ‚Üí   P2&#x27;+perm[6](K+1)</span><br></pre></td></tr></table></figure>

<p>Why don‚Äôt we do it again? This time let‚Äôs inject on both the key and <strong>the ciphertext</strong>, and do the decryption.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">=   P0+perm[0](1)           ‚Üí   P0&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">:   P0+perm[0](1)           ‚Üí   P0&#x27;&#x27;</span><br><span class="line">‚Üëperm[0] key add</span><br><span class="line">:   P0+perm[0](K)           ‚Üí   P0&#x27;&#x27;+perm[0](K)</span><br><span class="line">‚Üë16 sub[1]-perm[2]</span><br><span class="line">:   P1                      ‚Üí   P1+perm[3](1)</span><br><span class="line">‚Üëperm[3] key add</span><br><span class="line">:   P1+perm[3](K+1)         ‚Üí   P1+perm[3](K+1)</span><br><span class="line">‚Üë16 sub[4]-perm[5]</span><br><span class="line">:   P2&#x27;                     ‚Üí   P2&#x27;</span><br><span class="line">‚Üëperm[6] key add</span><br><span class="line">:   P2&#x27;+perm[6](K+1)        ‚Üí   P2&#x27;+perm[6](K)</span><br><span class="line"></span><br><span class="line">‚Üë   P2&#x27;+perm[6](K+1), K+1   ‚Üí   P2&#x27;+perm[6](K), K</span><br><span class="line">Decryption</span><br></pre></td></tr></table></figure>

<p>This means a lot: now we have a pair of $(P_0, P_0‚Äô‚Äô)$ which only have 1 bit difference after the first round of encryption. Let take another step forward‚Ä¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Encryption</span><br><span class="line">‚Üì   P0&#x27;&#x27;, K                 ‚Üí   P0&#x27;&#x27;+perm[0](1), K+1</span><br><span class="line"></span><br><span class="line">:   P0&#x27;&#x27;                    ‚Üí   P0&#x27;&#x27;+perm[0](1)</span><br><span class="line">‚Üìperm[0] key add</span><br><span class="line">:   P0&#x27;&#x27;+perm[0](K)         ‚Üí   P0&#x27;&#x27;+perm[0](1)+perm[0](K+1) = P0&#x27;&#x27;+perm[0](K)</span><br><span class="line">‚Üì16 sub[1]-perm[2]</span><br><span class="line">:   P1+perm[3](1)           ‚Üí   P1+perm[3](1)</span><br><span class="line">‚Üìperm[3] key add</span><br><span class="line">:   P1+perm[3](K+1)         ‚Üí   P1+perm[3](K+1)+perm[3](K+1) = P1</span><br><span class="line">‚Üì16 sub[4]-perm[5]</span><br><span class="line">:   P2&#x27;                     ‚Üí   P2</span><br><span class="line">‚Üìperm[6] key add</span><br><span class="line">:   P2&#x27;+perm[6](K)          ‚Üí   P2+perm[6](K+1) = P2+perm[6](K)+perm[6](1)</span><br><span class="line"></span><br><span class="line">=   P2&#x27;+perm[6](K)          ‚Üí   P2+perm[6](K)+perm[6](1)</span><br></pre></td></tr></table></figure>

<p>Finally, we manage to obtain a ciphertext with 1 bit difference compared to the original one. Based on this we can construct a distinguisher with our additional fault injection:</p>
<ol>
<li>Encrypt a random plaintext with the original key.</li>
<li>Inject 1 bit additional fault on the i-th bit of the key.</li>
<li>Obtain the magic ciphertext with 1 bit fault injected.</li>
</ol>
<p>If success, the additional fault on the i-th bit equals to a 1 bit xor fault. For most parts of the key, this implies the i-th bit is 0 (with high probability). Injection on the MSB may always cause 1 bit fault so we need to bruteforce it instead.</p>
<ul>
<li><a href="day2/limeade/exp.py">exp.py</a></li>
</ul>
<h2 id="ella"><a href="#ella" class="headerlink" title="(*)ella"></a>(*)ella</h2><blockquote>
<ul>
<li><a href="day2/ella/ella.py">ella.py</a></li>
</ul>
</blockquote>
<blockquote>
<p>No need for any paper, it‚Äôs just parity statistics.</p>
</blockquote>
<p>I may spend more time on this challenge later.</p>
<h1 id="day3"><a href="#day3" class="headerlink" title="day3"></a>day3</h1><h2 id="NoisyChannel"><a href="#NoisyChannel" class="headerlink" title="NoisyChannel"></a>NoisyChannel</h2><blockquote>
<ul>
<li><a href="day3/NoisyChannel/server.py">server.py</a></li>
</ul>
</blockquote>
<h3 id="Our-Solution"><a href="#Our-Solution" class="headerlink" title="Our Solution"></a>Our Solution</h3><p>It turns out that <code>randbytes</code> is implemented with <code>getrandbits</code>, with MT19937 as the prng core.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># random.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">randbytes</span>(<span class="params">self, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Generate n random bytes.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">self</span>.getrandbits(n * <span class="number">8</span>).to_bytes(n, <span class="string">&#x27;little&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Our target is to find a kernel vector that can be used for any random seeds. If this is even possible, it implies we are dealing with a non-full-rank linear system. Therefore, we can randomly generate sets of data, concatenate them, and then extract a non-trivial vector from its left kernel space as the answer.</p>
<blockquote>
<ul>
<li><a href="day3/NoisyChannel/exp.py">exp.py</a></li>
</ul>
</blockquote>
<h2 id="LCC-LLC"><a href="#LCC-LLC" class="headerlink" title="(*)LCC LLC"></a>(*)LCC LLC</h2><blockquote>
<ul>
<li><a href="day3/lccllc/app.py">app.py</a></li>
<li><a href="day3/lccllc/crypto.py">crypto.py</a></li>
<li>static</li>
<li><ul>
<li><a href="day3/lccllc/static/page.css">page.css</a></li>
</ul>
</li>
<li>templates</li>
<li><ul>
<li><a href="day3/lccllc/templates/index.html">index.html</a></li>
</ul>
</li>
<li><ul>
<li><a href="day3/lccllc/templates/layout.html">layout.html</a></li>
</ul>
</li>
</ul>
</blockquote>
<p>Here comes a McEliece challenge.</p>
<h3 id="Decode-Failure-Oracle"><a href="#Decode-Failure-Oracle" class="headerlink" title="Decode Failure Oracle"></a>Decode Failure Oracle</h3><p>Core functions below. </p>
<p>The server uses McEliece to generate access tokens, and our target is to forge a valid token with admin privilege. </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">McEliece</span>(<span class="title class_ inherited__">BinaryGoppaCode</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">self, msg: <span class="built_in">bytes</span>, eloc: <span class="type">List</span>[<span class="built_in">int</span>] = <span class="literal">None</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot; Encrypts a message. &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="number">8</span> * <span class="built_in">len</span>(msg) &lt;= <span class="variable language_">self</span>.k</span><br><span class="line">        mvec = Bytes2BitVec(msg, <span class="variable language_">self</span>.k)</span><br><span class="line">        <span class="keyword">if</span> eloc <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            evec = <span class="variable language_">self</span>._RandomMaxWeight()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            evec = Matrix(GF(<span class="number">2</span>), [<span class="number">1</span> <span class="keyword">if</span> i <span class="keyword">in</span> eloc <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.n)])</span><br><span class="line">        cvec = mvec * <span class="variable language_">self</span>.maskedG + evec</span><br><span class="line">        <span class="keyword">return</span> BitVec2Bytes(cvec)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">self, cip: <span class="built_in">bytes</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">bytes</span>, <span class="built_in">set</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot; Decrypts a ciphertext. &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(cip) &lt;= -(-<span class="variable language_">self</span>.n // <span class="number">8</span>)</span><br><span class="line">        cvec = Bytes2BitVec(cip, <span class="variable language_">self</span>.n)</span><br><span class="line">        mvec, evec = <span class="variable language_">self</span>.DecodeCodeWord(cvec * <span class="variable language_">self</span>.Pinv)</span><br><span class="line">        eloc = <span class="built_in">set</span>([i <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">enumerate</span>((evec * <span class="variable language_">self</span>.P).<span class="built_in">list</span>()) <span class="keyword">if</span> j])</span><br><span class="line">        <span class="keyword">return</span> BitVec2Bytes(mvec * <span class="variable language_">self</span>.Sinv), eloc</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCC</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">GenerateToken</span>(<span class="params">self, username: <span class="built_in">str</span>, admin: <span class="built_in">bool</span> = <span class="literal">False</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot; Generates a token. &quot;&quot;&quot;</span></span><br><span class="line">        salt = os.urandom(<span class="number">24</span>)</span><br><span class="line">        token = json.dumps(&#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span> : username,</span><br><span class="line">            <span class="string">&#x27;admin&#x27;</span> : admin,</span><br><span class="line">            <span class="string">&#x27;salt&#x27;</span> : B64Encode(salt)</span><br><span class="line">        &#125;).encode()</span><br><span class="line">        timestamp, eloc, etag = <span class="variable language_">self</span>.HashErrorLocs(salt)</span><br><span class="line">        encToken = <span class="variable language_">self</span>.code.Encrypt(token, eloc)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span>.join(B64Encode(i) <span class="keyword">for</span> i <span class="keyword">in</span> [timestamp, salt, etag, encToken])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">LoadToken</span>(<span class="params">self, token: <span class="built_in">str</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot; Loads a token. &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            timestamp, salt, etag, encToken = [B64Decode(i) <span class="keyword">for</span> i <span class="keyword">in</span> token.split(<span class="string">&#x27;.&#x27;</span>)]</span><br><span class="line">            decToken, eloc = <span class="variable language_">self</span>.code.Decrypt(encToken)</span><br><span class="line">            loadedToken = json.loads(decToken.strip(<span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Failed to load token...&#x27;</span>)</span><br><span class="line">        <span class="comment"># _, _eloc, _etag = self.HashErrorLocs(salt, timestamp)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># assert _eloc == eloc</span></span><br><span class="line">            <span class="comment"># assert _etag == etag</span></span><br><span class="line">            <span class="keyword">assert</span> salt == B64Decode(loadedToken[<span class="string">&#x27;salt&#x27;</span>])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Invalid token...&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> loadedToken</span><br><span class="line"></span><br><span class="line"><span class="comment"># Homepage</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> token:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            userData = lcc.LoadToken(token)</span><br><span class="line">            flash(<span class="string">&#x27;Succesfully loaded your token.&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> userData[<span class="string">&#x27;admin&#x27;</span>] == <span class="literal">True</span>:</span><br><span class="line">                content = FLAG.decode()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                content = <span class="string">&#x27;Nothing to see here. Where you looking for something?&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> render_template(</span><br><span class="line">                <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">                username = <span class="string">&#x27; &#x27;</span> + userData[<span class="string">&#x27;username&#x27;</span>],</span><br><span class="line">                content = content</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">            flash(<span class="string">&#x27;ERROR:: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(e)), <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;ERROR:: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(e)))</span><br><span class="line">            flash(<span class="string">&#x27;Something went wrong...&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flash(<span class="string">&#x27;No token found. Get a token by visiting &quot;./gettoken/&lt;username&gt;&quot;.&#x27;</span>, <span class="string">&#x27;warning&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, username=<span class="string">&#x27;&#x27;</span>, content=<span class="string">&#x27;Please load your token or generate a new one.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>There‚Äôs not so much we can do actually, since we‚Äôre only provided with some partly controllable tokens (even without the public key).</p>
<p>You can notice that <code>LoadToken</code> does not check <code>eloc</code> or <code>etag</code>, which may lead to something interesting. For McEliece, <code>Decrypt</code> works if there‚Äôre <strong>less than</strong> <code>t</code> positions of errors. This means if we inject 1 more bit error into a token, it will not be decoded successfully. But if we inject noise again at a ‚Äúdirty‚Äù position, the effects of the noise will be cancelled out and it still serves as a valid token (again, because <code>eloc</code> is not checked).</p>
<p>So we can flip each bit of the token and try to decode it. By checking the response status, we can leak the ‚Äúdirty‚Äù bits of the token, thus recovering a ‚Äúclean‚Äù McEliece token. This gives us some advantages to forge new tokens based on the existing ones: if one try to do so with ‚Äúdirty‚Äù tokens (i.e. linear combinations), noise accumulation will render the token unusable.</p>
<h3 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h3><p>For one token recovery, we need <code>n</code> times interactions, which costed 20~30 minutes during the competition. Parallelization should be a good strategy in <code>flask</code> but it didn‚Äôt work due to some deployment issues. This took all my time during the competition and it‚Äôs kinda disappointing actually‚Ä¶still cool challenge though :D</p>
<p>Another optimization is that we can flip 2 bits at one time:</p>
<ol>
<li>2 ‚Äúclean‚Äù bits: the token will be <strong>rejected</strong> since there‚Äôre <code>t+2</code> ‚Äúdirty‚Äù bits.</li>
<li>1 ‚Äúclean‚Äù bit and 1 ‚Äúdirty‚Äù bit: the token will be <strong>accepted</strong> since there‚Äôre still <code>t</code> ‚Äúdirty‚Äù bits.</li>
<li>2 ‚Äúdirty‚Äù bits: the token will be <strong>accepted</strong> since there‚Äôre <code>t-2</code> ‚Äúdirty‚Äù bits.</li>
</ol>
<p>By doing this <code>n/2</code> times, we can ambiguously locate each ‚Äúdirty‚Äù bits. With another <code>2*t</code> (less than this actually) checks and we can recover the exact <code>eloc</code>.</p>
<h3 id="JSON-Manipulation"><a href="#JSON-Manipulation" class="headerlink" title="JSON Manipulation"></a>JSON Manipulation</h3><p>Let‚Äôs delve deeper into this challenge. It may be a choice to recover the public key with enough ‚Äúclean‚Äù tokens, which enables us to forge any valid tokens. But it requires too much interactions.</p>
<p>Since we can control the <code>username</code> part of the token, it can be optimized with some JSON tricks. But first we need to make something clear. </p>
<p>You may notice that <code>json</code> works a little different on the server. This is because <code>app.json</code> instead of <code>json</code> will be called when <code>flask.app</code> is working, which will sort the keys first before serializing a JSON object.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">a = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;admin&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;salt&quot;</span>: <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">app.json.sort_keys</span><br><span class="line"><span class="comment"># True</span></span><br><span class="line">app.json.dumps(a)</span><br><span class="line"><span class="comment"># &#123;&quot;admin&quot;: false, &quot;salt&quot;: &quot;&quot;, &quot;username&quot;: &quot;&quot;&#125;</span></span><br><span class="line">app.json.sort_keys = <span class="literal">False</span></span><br><span class="line">app.json.dumps(a)</span><br><span class="line"><span class="comment"># &#123;&quot;username&quot;: &quot;&quot;, &quot;admin&quot;: false, &quot;salt&quot;: &quot;&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">json.dumps(a)</span><br><span class="line"><span class="comment"># &#123;&quot;username&quot;: &quot;&quot;, &quot;admin&quot;: false, &quot;salt&quot;: &quot;&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<p>In this case, we are enabled to manipulate JSON by constructing a malicious <code>username</code>. For instance: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">username = <span class="string">&#x27;&quot;,&quot;admin&quot;:true,&quot;salt&quot;:&quot;&#x27;</span></span><br><span class="line">a = <span class="string">&#x27;&#123;&quot;admin&quot;: false, &quot;salt&quot;: &quot;&quot;, &quot;username&quot;: &quot;$&quot;&#125;&#x27;</span>.replace(<span class="string">&quot;$&quot;</span>, username)</span><br><span class="line">json.loads(a)</span><br><span class="line"><span class="comment"># &#123;&#x27;admin&#x27;: True, &#x27;salt&#x27;: &#x27;&#x27;, &#x27;username&#x27;: &#x27;&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<p>By doing this we can 1) set <code>admin</code> to <code>True</code> and 2) set <code>salt</code> to a valid <code>B64</code> string (an empty string here).</p>
<p>We can not do this directly. Instead we construct 3 usernames satisfying <code>xor(a, xor(b, c)) = target</code>, and xor the corresponding tokens together. With high probability, we can get a valid token (since we need the <code>salt</code> part to be valid as well). Here we only need 2 ‚Äúclean‚Äù tokens and the result token will still be accepted. </p>
<h1 id="In-Saudi-Arabia"><a href="#In-Saudi-Arabia" class="headerlink" title="In Saudi Arabia"></a>In Saudi Arabia</h1><p>Still can‚Äôt believe we did it, my teammates are so strong. Got some luck too I guess.</p>
<table>
<thead>
<tr>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/team1.jpg" alt="team1"></th>
</tr>
</thead>
</table>
<p>Met so many old and new friends here, enjoyed. </p>
<p>But 3-day competition is really tiring and we didn‚Äôt have so much time or energy to travel around. Will do more exploitation in the city if I come next year.</p>
<table>
<thead>
<tr>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/team2.jpg" alt="team2"></th>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/bhmea.jpg" alt="bhmea"></th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/3.jpg" alt="3"></th>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/4.jpg" alt="4"></th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/2.jpg" alt="2"></th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th><img src="/2025/12/09/blackhatmeactffinal2025/images/5.jpg" alt="5"></th>
</tr>
</thead>
</table>
]]></content>
      <tags>
        <tag>AES</tag>
        <tag>SPN</tag>
        <tag>McEliece</tag>
      </tags>
  </entry>
  <entry>
    <title>These Walls::Codegate CTF 2025 Qual</title>
    <url>/2025/04/05/codegatectf2025/</url>
    <content><![CDATA[<p>Time: 2025.03.29 (online)</p>
<p>Time to learn more about elliptic curve :D</p>
<h2 id="These-Walls-5-solves"><a href="#These-Walls-5-solves" class="headerlink" title="These Walls (5 solves)"></a>These Walls (5 solves)</h2><p><a href="https://github.com/soon-haari/my-ctf-challenges/tree/main/2025-codegate/crypto-thesewalls">https://github.com/soon-haari/my-ctf-challenges/tree/main/2025-codegate/crypto-thesewalls</a></p>
<blockquote>
<ul>
<li><a href="These_Walls/chall.py">chall.py</a></li>
<li>output.txt</li>
</ul>
</blockquote>
<p>Our target is to solve DDH&#x2F;DLP on ECC to get the <code>key</code>.</p>
<h3 id="Curves-Recovery"><a href="#Curves-Recovery" class="headerlink" title="Curves Recovery"></a>Curves Recovery</h3><p>First we need to recover the elliptic curve from the given points. This can be easily done by <code>groebner_basis</code> on ZZ.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Ps = [ast.literal_eval(P) <span class="keyword">for</span> P <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).readlines()[<span class="number">2</span>:]]</span><br><span class="line"></span><br><span class="line">R, (a, b) = PolynomialRing(ZZ, <span class="string">&#x27;a,b&#x27;</span>).objgens()</span><br><span class="line">Fs = [x**<span class="number">3</span> + a*x + b - y**<span class="number">2</span> <span class="keyword">for</span> x, y <span class="keyword">in</span> dat]</span><br><span class="line">B = Ideal(Fs).groebner_basis()</span><br><span class="line">n = B[-<span class="number">1</span>]</span><br><span class="line">a = ZZ(n-B[<span class="number">0</span>].univariate_polynomial()(<span class="number">0</span>))</span><br><span class="line">b = ZZ(n-B[<span class="number">1</span>].univariate_polynomial()(<span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">102426836944425277819174256940128868455066517869185115488781035394164877927042198980921397582250905694209313963017944880679709788694772632564808279062807699845761214703586660326307989151472431126842544189892251409194318824261554131269698538462346988910692541060196190265045309883144365795763912362099350625483</span></span><br><span class="line">a = <span class="number">59988839927984767712262022881015186528306823080680093817066551387449092966635391654583736371714324230765899668876056205191762535690049456590296016977519955444196107647233071737264095096436949854658419817766417617008402215963718256820349403830936535830427821814691174887502426870436662513573210000832221322398</span></span><br><span class="line">b = <span class="number">101967710743792389969422216712450509569034697830818344524896876130478391402643388132308880397086156977788425616725940825720775848656512466204212492162471675713660761367404158291366066068856768564375952666036454337938403204290723496566781748665353311583138442143621327486984669015180894834194757115816809502955</span></span><br></pre></td></tr></table></figure>

<p>But this is not enough, since we have a composite $n$ here. </p>
<p>For a curve $E_p$ with order $o_p$, we have $o_p \cdot P &#x3D; (0, 0)$. When it comes to $E_n$ where $p | n$, we have $o_p \cdot P &#x3D; (k_x \cdot p, k_y \cdot p)$. Multiplication based on this may fail since there‚Äôs no inverse element for $k \cdot p$, and we can extract $p$ through the error message.</p>
<p>In short, I just kept run this and get new prime factors with <code>gcd</code>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">o = <span class="number">118549579796788515994414649236369265269780996946642393375504713268996543836492572997532134962413661837052222678148616587175464294656866212083879163757595198637277720148049394221272652120067946542481202345536577647854319626518830885330021003068475187962796231844540355486949322214342559093662111580693859480</span></span><br><span class="line">ps = [(<span class="number">2</span>, <span class="number">3</span>), (<span class="number">3</span>, <span class="number">2</span>), (<span class="number">5</span>, <span class="number">1</span>), (<span class="number">11</span>, <span class="number">1</span>), (<span class="number">19</span>, <span class="number">1</span>), (<span class="number">31</span>, <span class="number">1</span>), (<span class="number">53</span>, <span class="number">1</span>), (<span class="number">349</span>, <span class="number">1</span>), (<span class="number">3517</span>, <span class="number">1</span>), (<span class="number">673063</span>, <span class="number">1</span>), (<span class="number">2745521</span>, <span class="number">1</span>), (<span class="number">55050007</span>, <span class="number">1</span>), (<span class="number">377214161</span>, <span class="number">1</span>), (<span class="number">30174718114417</span>, <span class="number">1</span>), (<span class="number">139792886025540383</span>, <span class="number">1</span>), (<span class="number">388450213394528490535805887</span>, <span class="number">1</span>), (<span class="number">2717597692908121319788497985451</span>, <span class="number">2</span>), (<span class="number">3692983360407686094702508373879</span>, <span class="number">1</span>), (<span class="number">1405747484361299393418580978953630281779614293727193</span>, <span class="number">1</span>), (<span class="number">324094280281900209908870811008292068290746348301400744740589987</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="keyword">assert</span> o == prod(pi**i <span class="keyword">for</span> pi, i <span class="keyword">in</span> ps)</span><br><span class="line"></span><br><span class="line">E = EllipticCurve(Zmod(n), [a, b])</span><br><span class="line">P = E(Ps[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> pi, _ <span class="keyword">in</span> ps:</span><br><span class="line">    oi = o // pi</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        Q = oi*P</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(pi, e)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">p0 = <span class="number">3562548874780288796769030192977</span></span><br><span class="line">p1 = <span class="number">3692983360407686094702508373879</span></span><br><span class="line">p2 = <span class="number">324094280281900209908870811008292068290746348301400744740589987</span></span><br><span class="line">p3 = <span class="number">2717597692908121319788497985451</span></span><br><span class="line"><span class="keyword">assert</span> n == p0 * p1**<span class="number">2</span> * p2**<span class="number">2</span> * p3**<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>Now we need to solve DDH on each curve $E_{p_i}$.</p>
<h3 id="Part1-Singular-Curve"><a href="#Part1-Singular-Curve" class="headerlink" title="Part1: Singular Curve"></a>Part1: Singular Curve</h3><p><a href="https://crypto.stackexchange.com/questions/70373/why-are-singular-elliptic-curves-bad-for-crypto">Why are singular ‚Äúelliptic‚Äù curve bad for crypto</a></p>
<blockquote>
<p>For an elliptic curve $E: y^2 &#x3D; x^3 + a \cdot x + b \pmod{p}$, the curve is singular if $\Delta &#x3D; 4 a^3 + 27 b^2 &#x3D; 0 \pmod{p}$, which implies that $f(x) &#x3D; x^3 + a \cdot x + b \pmod{p}$ has a double&#x2F;triple root.</p>
</blockquote>
<p>It turns out that we have a singular curve $E_{p_0}$. At this point we can transfrom the original DLP into a much easier one.</p>
<ol>
<li>$f(x) &#x3D; (x - \alpha)^3$: There are exacly $p$ non-singular points, and we can map them to the <strong>addictive</strong> group of $GF_p$ through $(x, y) \rightarrow \frac{x - \alpha}{y}$.</li>
<li>$f(x) &#x3D; (x - \alpha)^2 \cdot (x - \beta)$: There are $p-1$ or $p+1$ points, and we can map them to the <strong>multiplicative</strong> group of $GF_{p^2}$ (with $p^2-1 &#x3D; (p-1)\cdot(p+1)$ elements) through $(x, y) \rightarrow \frac{y+\sqrt{\alpha - \beta} \cdot (x - \alpha)}{y-\sqrt{\alpha - \beta} \cdot (x - \alpha)}$.</li>
<li>$f(x) &#x3D; (x - \alpha) \cdot (x - \beta) \cdot (x - \gamma)$: Nah this is impossible.</li>
</ol>
<p>In case 2, it‚Äôs quite clear that we extend the group with $x^2 &#x3D; (\alpha - \beta) \pmod{p}$. If there exist the corresponding square roots, we just map the original group to $GF_p$.</p>
<p>We have $ p_0+1 &#x3D; 2 \cdot 7841 \cdot 240017 \cdot 1190977577 \cdot 79471936121$, and it takes less than 10s to solve one DLP on $GF_{p^2}$. Actually we can just solve one or two of them, and check DDH with the rest.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">singular_attack</span>(<span class="params">p, a, b, P, Q</span>):</span><br><span class="line">    Px, Py = P</span><br><span class="line">    Qx, Qy = Q</span><br><span class="line"></span><br><span class="line">    x = GF(p)[<span class="string">&quot;x&quot;</span>].gen()</span><br><span class="line">    f = x**<span class="number">3</span> + a*x + b</span><br><span class="line">    roots = f.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(roots) == <span class="number">1</span>:</span><br><span class="line">        alpha = roots[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">        u = (Px - alpha) / Py</span><br><span class="line">        v = (Qx - alpha) / Qy</span><br><span class="line">        s = v / u</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(s)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(roots) == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">if</span> roots[<span class="number">0</span>][<span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">            alpha = roots[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">            beta = roots[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">elif</span> roots[<span class="number">1</span>][<span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">            alpha = roots[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">            beta = roots[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        t = (alpha - beta).sqrt()</span><br><span class="line">        u = (Py + t * (Px - alpha)) / (Py - t * (Px - alpha))</span><br><span class="line">        v = (Qy + t * (Qx - alpha)) / (Qy - t * (Qx - alpha))</span><br><span class="line">        s = v.log(u)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(s)</span><br><span class="line">ans0 = [singular_attack(p0, a, b, Ps[i], Ps[i+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> tqdm.trange(<span class="built_in">len</span>(Ps)-<span class="number">1</span>)]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">s0 = 1688818121111580066310934554129</span><br><span class="line">ans0 = [1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1]</span><br></pre></td></tr></table></figure>

<h3 id="Part2-p-adic-Field"><a href="#Part2-p-adic-Field" class="headerlink" title="Part2: p-adic Field"></a>Part2: p-adic Field</h3><p><a href="https://affine.group/writeup/2021-01-Zer0pts#pure-division">Sth old but cool.</a> </p>
<p>For $(p_1, p_2, p_3)$, we need to solve DLP&#x2F;DDH on $E_{p^k}$. It turns out that the order is $o_p \cdot p^{k-1}$ where $o_p$ is the order of $E_p$. With p-adic field, we can just solve DLP $\pmod{p^{k-1}}$. This is similar to solve DLP $y &#x3D; g^x \pmod{p^k}$.</p>
<p>Really fast.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">padic_attack</span>(<span class="params">p, k, a, b, P, Q</span>):</span><br><span class="line">    E = EllipticCurve(Zmod(p**k), [a, b])</span><br><span class="line">    ordp = E.change_ring(GF(p)).order()</span><br><span class="line"></span><br><span class="line">    P = ordp*E.change_ring(Qp(p, k))(P)</span><br><span class="line">    Q = ordp*E.change_ring(Qp(p, k))(Q)</span><br><span class="line">    s = Zmod(p**(k-<span class="number">1</span>))((P[<span class="number">0</span>] / P[<span class="number">1</span>]) / (Q[<span class="number">0</span>] / Q[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(s)</span><br><span class="line">ans1 = [padic_attack(p1, <span class="number">2</span>, a, b, Ps[i], Ps[i+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> tqdm.trange(<span class="built_in">len</span>(Ps)-<span class="number">1</span>)]</span><br><span class="line">ans2 = [padic_attack(p2, <span class="number">2</span>, a, b, Ps[i], Ps[i+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> tqdm.trange(<span class="built_in">len</span>(Ps)-<span class="number">1</span>)]</span><br><span class="line">ans3 = [padic_attack(p3, <span class="number">3</span>, a, b, Ps[i], Ps[i+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> tqdm.trange(<span class="built_in">len</span>(Ps)-<span class="number">1</span>)]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s1 = <span class="number">161442084316875579136566655050</span></span><br><span class="line">ans1 = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">s2 = <span class="number">124693667754253363360592289430893581474062041013016987009502208</span></span><br><span class="line">ans2 = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">s3 = <span class="number">5975425618449852857611277904948728242283739833255577381465035</span></span><br><span class="line">ans3 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Part3-MOV"><a href="#Part3-MOV" class="headerlink" title="Part3: MOV"></a>Part3: MOV</h3><p>Now we just need to solve DLP&#x2F;DDH on $E_p$ for $(p_1, p_2, p_3)$. These curves all satisfy $o_p &#x3D; p+1$, so the embedding degree $k &#x3D; 2$. This time we can try MOV attack which maps curve points to elements on $GF_{p^k}$ with pairing tech, solving an easier DLP.</p>
<p>It is worth to notice that we can solve DLP more easily only because $GF_{p^k}$ has better structure than $E_p$. The order of the elements on $GF_{p^k}$ is $o_p$ and it‚Äôs still hard to solve DLP if $o_p$ has large factors. In this challenge, we can solve completely DLP on $p_1$ since $p_1 + 1 &#x3D; 2^3 \cdot 3^2 \cdot 5 \cdot 31 \cdot 3517 \cdot 673063 \cdot 139792886025540383$.</p>
<blockquote>
<p>It‚Äôs said to be possible to solve such DLP on $GF_p^2$ with cado-nfs. </p>
</blockquote>
<p>It takes about 20min to solve one, so this time we have to solve one or two answers and then check DDH on the rest.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mov_attack</span>(<span class="params">p, a, b, P, Q</span>):</span><br><span class="line">    E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">    <span class="built_in">ord</span> = E.order()</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">pow</span>(p, k, <span class="built_in">ord</span>) != <span class="number">1</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    Ek = E.base_extend(GF(p**k))</span><br><span class="line">    G = Ek.gens()[<span class="number">0</span>]</span><br><span class="line">    P = Ek(P).weil_pairing(G, <span class="built_in">ord</span>)</span><br><span class="line">    Q = Ek(Q).weil_pairing(G, <span class="built_in">ord</span>)</span><br><span class="line">    s = Q.log(P)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(s)</span><br><span class="line">ans1 = [mov_attack(p1, a, b, Ps[i], Ps[i+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> tqdm.trange(<span class="built_in">len</span>(Ps)-<span class="number">1</span>)]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s1 = <span class="number">860437940168965817900625942259</span></span><br><span class="line">ans1 = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Part4-Distortion-Map"><a href="#Part4-Distortion-Map" class="headerlink" title="Part4: Distortion Map"></a>Part4: Distortion Map</h3><p><a href="https://crypto.stanford.edu/pbc/thesis.pdf">Check this.</a></p>
<p>Since it‚Äôs hard to completely solve DLP for $(p_2, p_3)$, we need to find some luck on DDH itself. An apparent idea is to solve DDH with pairing. For instance, we can check whether $e(P_i, P_{j+1}) &#x3D; e(P_j, P_{i+1})$ holds.</p>
<p>But this doesn‚Äôt work, cuz you will find $e(P_i, P_{i+1}) &#x3D; 1$ for all $i$. For <code>weil_pairing</code>, we shall take two points from <strong>different</strong> subgroups to compute bilinear pairing, otherwise it will just degenerate to 1. I‚Äôm not familiar with both <code>weil_pairing</code> and <code>tate_pairing</code> but neither of them worked.</p>
<p>Here, both curves on $(p_2, p_3)$ are supersingular since $o_p &#x3D; p+1$. There exist several special supersingular curves on which we can do something cool. For this challenge, here is what we need:</p>
<ul>
<li>Type A Curve: $y^2 &#x3D; x^3 + a \cdot x$</li>
<li>Type B Curve: $y^2 &#x3D; x^3 + b$</li>
</ul>
<p>One can find a distrotion map $\Phi: E_p \rightarrow E_{p^2}$ on these curves, and construct a nondegenerate bilinear map $e(P, Q) &#x3D; f(P, \Phi(Q))$ (where $f$ is the original <code>weil_pairing</code>). You can check for more details in the materials above.</p>
<p>Here we can use both of them to solve DDH on $(p_2, p_3)$.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">type_a_ddh_attack</span>(<span class="params">p, a, b, P0, Q0, Pi, Qi</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">distortion_map</span>(<span class="params">P</span>):</span><br><span class="line">        Px, Py = P.xy()</span><br><span class="line">        z = Fp2.gens()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> E(-Px, z*Py)</span><br><span class="line"></span><br><span class="line">    x = var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    Fp2 = GF(p2**<span class="number">2</span>, <span class="string">&#x27;z&#x27;</span>, modulus=x**<span class="number">2</span>+<span class="number">1</span>)</span><br><span class="line">    E = EllipticCurve(Fp2, [a, b])</span><br><span class="line">    e0 = E(P0).weil_pairing(distortion_map(E(Qi)), p+<span class="number">1</span>)</span><br><span class="line">    e1 = E(Pi).weil_pairing(distortion_map(E(Q0)), p+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(e0 == e1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">type_b_ddh_attack</span>(<span class="params">p, a, b, P0, Q0, Pi, Qi</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">distortion_map</span>(<span class="params">P</span>):</span><br><span class="line">        Px, Py = P.xy()</span><br><span class="line">        z = Fp2(<span class="number">1</span>).nth_root(<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">return</span> E(z*Px, Py)</span><br><span class="line"></span><br><span class="line">    Fp2 = GF(p**<span class="number">2</span>)</span><br><span class="line">    E = EllipticCurve(Fp2, [a, b])</span><br><span class="line">    e0 = E(P0).weil_pairing(distortion_map(E(Qi)), p+<span class="number">1</span>)</span><br><span class="line">    e1 = E(Pi).weil_pairing(distortion_map(E(Q0)), p+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(e0 == e1)</span><br><span class="line"></span><br><span class="line">ans2 = [type_a_ddh_attack(p2, a, b, Ps[<span class="number">0</span>], Ps[<span class="number">1</span>], Ps[i], Ps[i+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> tqdm.trange(<span class="built_in">len</span>(Ps) - <span class="number">1</span>)]</span><br><span class="line">ans3 = [type_b_ddh_attack(p3, a, b, Ps[<span class="number">0</span>], Ps[<span class="number">1</span>], Ps[i], Ps[i+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> tqdm.trange(<span class="built_in">len</span>(Ps) - <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ans2 = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">ans3 = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Get-Flag"><a href="#Get-Flag" class="headerlink" title="Get Flag"></a>Get Flag</h3><p>Finally.</p>
<p>We need to combine the DDH answers from all subgroups. For any position i, if one 0 appears then the answer is 0. We may mischeck some 0s to 1s in certain subgroups, but the opposite condition will never occur. For the first position, just guess it out.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ans = [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">]</span><br><span class="line">ans = [prod([ans[j][i] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ans))]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, [<span class="number">1</span>] + ans))[::-<span class="number">1</span>], <span class="number">2</span>)</span><br><span class="line">key = long_to_bytes(key, <span class="number">32</span>)</span><br><span class="line">enc = <span class="string">&#x27;5ade26f7b0461ec24e2f6a328be00be8e49e7707b5533c8da3b42bbb41a2aeb4ec8a63c2d625f891b6cce1c6842bda77a31957351aa90525385df3d80431db3c9c73183207267adccf016cbda326cf872c365903d63e20fab0f31bb2ef19b31ea151db097514b49f3fdbc05b8a26ae02&#x27;</span></span><br><span class="line">flag = AES.new(key, AES.MODE_CTR, nonce=<span class="built_in">bytes</span>(<span class="number">12</span>)).decrypt(<span class="built_in">bytes</span>.fromhex(enc))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># codegate2025&#123;If_these_weils_could_talk_(I_can_feel_your_reign_when_it_cries_supersingular_curves_inside_of_you)&#125;</span></span><br></pre></td></tr></table></figure>

<p>Special thanks to @Á≥ñÈÜãÂ∞èÈ∏°Âùó, who helped untangle many of the mathematical knots for me.</p>
]]></content>
      <tags>
        <tag>ECC</tag>
      </tags>
  </entry>
  <entry>
    <title>Codegate CTF 2025 Final (Seoul, Koreaüá∞üá∑)</title>
    <url>/2025/07/14/codegatectffinal2025/</url>
    <content><![CDATA[<p>Time: 2025.07.10-11 (onsite)</p>
<p>I played Codegate CTF Final with r3kapig last week and we got 5th in the end. </p>
<p>Sincere thanks to my teammates and the organizers, I really enjoyed the game.</p>
<p><img src="/2025/07/14/codegatectffinal2025/images/scoreboard.png" alt="scoreboard"></p>
<h2 id="LEAk-12-solves"><a href="#LEAk-12-solves" class="headerlink" title="LEAk (12 solves)"></a>LEAk (12 solves)</h2><blockquote>
<ul>
<li><a href="LEAk/LEAk.py">LEAk.py</a></li>
</ul>
</blockquote>
<p>This is a standard implementation of LEA, which is a ARX-style block cipher. Our target is to recover the key through 15 at maximum times of fault injection without the value of the fault.</p>
<p>And my solution is based on <a href="https://eprint.iacr.org/2020/1534.pdf">this</a>. </p>
<p>The core of the attack is an algebraic representation of modular addition on $\mathbb{F}_{2^n}$. In short, we have the following equations if we try to inject a fault into the modular addition.</p>
<p>$$A \boxplus B &#x3D; C \Rightarrow A \boxplus (B \oplus \Delta B) &#x3D; C \oplus \Delta C$$</p>
<p>$$<br>\begin{cases}<br>c_0 &#x3D; a_0 + b_0 \\<br>c_i &#x3D; a_i + b_i + a_{i-1}b_{i-1} + (a_{i-1}+b_{i-1})(a_{i-1}+b_{i-1}+c_{i-1})\\<br>c_0+\Delta c_{0} &#x3D; a_0 + b_0 + \Delta b_0 \\<br>c_i+\Delta c_{i} &#x3D; a_i + b_i + \Delta b_i + a_{i-1}(b_{i-1}+\Delta b_{i-1}) + (a_{i-1}+b_{i-1}+\Delta b_{i-1})(a_{i-1}+b_{i-1}+\Delta b_{i-1}+c_{i-1})<br>\end{cases}<br>$$</p>
<p>With the knowledge of $(C, \Delta B, \Delta C)$, we can build a binary system with $2n$ variables, which can be solved through <code>Groebner Basis</code> or <code>z3-solver</code>. And we can recover the low $n-1$ bits of $(A, B)$ with enough samples (apparently we have no information about MSB).</p>
<p>In the second part we just need to choose the injection points, collect the outputs and recover the internal values using the above analysis. I implemented the paper‚Äôs strategy and here is a sketch.</p>
<ol>
<li>$\rightarrow X_{22}[0]$ for $RK_{23}[0]$ (31bit)</li>
<li>$\rightarrow X_{23}[1]$ for $RK_{23}[1] \oplus RK_{23}[2]$ (31bit)</li>
<li>$\rightarrow X_{23}[2]$ for $RK_{23}[3] \oplus RK_{23}[4]$ (31bit)</li>
<li>$\rightarrow X_{22}[0]$ (reuse stage 1) for $RK_{23}[5]$ (30bit)</li>
</ol>
<p>For more details you can check the original paper (and my exploit code). With some bruteforce on MSBs, we can recover the secret key.</p>
<p>In the paper the author takes 6 samples for each steps, and here we have only 5 (we need 1 sample for the original ciphertext). This slightly influences the success rate so we need several attempts.</p>
<blockquote>
<ul>
<li><a href="LEAk/exp.py">exp.py</a></li>
</ul>
</blockquote>
<p>It turns out the whole challenge is z3able but whatever :)</p>
<p>I actually enjoyed the implementation part, with snacks and classical music. Love and peace @codegate.</p>
<h2 id="smartLock-10-solves"><a href="#smartLock-10-solves" class="headerlink" title="smartLock (10 solves)"></a>smartLock (10 solves)</h2><blockquote>
<ul>
<li><a href="smartLock/smartLock.zip">smartLock</a></li>
</ul>
</blockquote>
<p>A tiny bug is that the server checks the answer by sending $m^d \pmod{n}$ and querying $m$, so we can just pass all the tests with the public keys. This can be figured out through the remote outputs.</p>
<p>According to our REer, we may need to solve 10 ACDP in 50s with strict parameters. I‚Äôve not tried it but it might be all about optimizations ig.</p>
<blockquote>
<ul>
<li><a href="smartLock/exp.py">exp.py</a></li>
</ul>
</blockquote>
<h2 id="In-Korea"><a href="#In-Korea" class="headerlink" title="In Korea"></a>In Korea</h2><p>Charming Seoul City. The weather is similar to that in my hometown.</p>
<p>Kinda hot in the first two days, but it‚Äôs just pleasant after that.</p>
<p>Glad to meet so many old and new friends :D</p>
<table>
<thead>
<tr>
<th><img src="/2025/07/14/codegatectffinal2025/images/myongtong.jpg" alt="myongtong"></th>
<th><img src="/2025/07/14/codegatectffinal2025/images/yondae.jpg" alt="yondae"></th>
</tr>
</thead>
</table>
<!-- ## (blockchain) DEX (8 solves)

> - [DEX](DEX/DEX.zip)

Later that night I tried the blockchain challenge with my teammates. Something new for me XD

The structure of the challenge is well-designed and a little complicated for me. But many of them are meant for the correctness and fairness of the challenge, so I'll just focus on the core part.

The initialization is done by contract `Setup`. In short there are two `DEX` contracts, deployed on `CODE` and `GATE` chain. At first there are `DEX_SUPPLY` of `tokenA/B/C` on each DEX, and our target is to possess all of them (`2*DEX_SUPPLY` of each token). And of course, we don't have enough money to do that.

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">contract <span class="title class_">Setup</span> &#123;</span><br><span class="line">    uint256 public constant <span class="variable constant_">CODE_CHAIN</span> = <span class="number">10</span>;</span><br><span class="line">    uint256 public constant <span class="variable constant_">GATE_CHAIN</span> = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    address public dex;</span><br><span class="line">    address public tokenA;</span><br><span class="line">    address public tokenB;</span><br><span class="line">    address public tokenC;</span><br><span class="line">    address public faucet;</span><br><span class="line">    address public faucetLogic;</span><br><span class="line">    bool public isSolved = <span class="literal">false</span>;</span><br><span class="line">    uint256 public constant <span class="variable constant_">DEX_SUPPLY</span> = <span class="number">600</span> ether;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">address _faucet</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        faucetLogic = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">FaucetLogic</span>());</span><br><span class="line">        faucet  = _faucet;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(block.<span class="property">chainid</span> == <span class="variable constant_">CODE_CHAIN</span>) &#123;</span><br><span class="line">            tokenA = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;CODE USDC&quot;</span>, <span class="string">&quot;cUSDC&quot;</span>));</span><br><span class="line">            tokenB = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;CODE PURR&quot;</span>, <span class="string">&quot;cPURR&quot;</span>));</span><br><span class="line">            tokenC = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;CODE MOODENG&quot;</span>, <span class="string">&quot;cMOODENG&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tokenA = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;GATE USDC&quot;</span>, <span class="string">&quot;gUSDC&quot;</span>));</span><br><span class="line">            tokenB = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;GATE PURR&quot;</span>, <span class="string">&quot;gPURR&quot;</span>));</span><br><span class="line">            tokenC = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&quot;GATE MOODENG&quot;</span>, <span class="string">&quot;gMOODENG&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Token</span>[] memory tokens = <span class="keyword">new</span> <span class="title class_">Token</span>[](<span class="number">3</span>);</span><br><span class="line">        tokens[<span class="number">0</span>] = <span class="title class_">Token</span>(tokenA);</span><br><span class="line">        tokens[<span class="number">1</span>] = <span class="title class_">Token</span>(tokenB);</span><br><span class="line">        tokens[<span class="number">2</span>] = <span class="title class_">Token</span>(tokenC);</span><br><span class="line"></span><br><span class="line">        dex = <span class="title function_">address</span>(<span class="keyword">new</span> <span class="title function_">DEX</span>(msg.<span class="property">sender</span>, tokens));</span><br><span class="line">        <span class="title class_">Token</span>(tokenA).<span class="title function_">mint</span>(<span class="title function_">address</span>(dex), <span class="variable constant_">DEX_SUPPLY</span>);</span><br><span class="line">        <span class="title class_">Token</span>(tokenB).<span class="title function_">mint</span>(<span class="title function_">address</span>(dex), <span class="variable constant_">DEX_SUPPLY</span>);</span><br><span class="line">        <span class="title class_">Token</span>(tokenC).<span class="title function_">mint</span>(<span class="title function_">address</span>(dex), <span class="variable constant_">DEX_SUPPLY</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Token</span>(tokenA).<span class="title function_">transferOwnership</span>(msg.<span class="property">sender</span>);</span><br><span class="line">        <span class="title class_">Token</span>(tokenB).<span class="title function_">transferOwnership</span>(msg.<span class="property">sender</span>);</span><br><span class="line">        <span class="title class_">Token</span>(tokenC).<span class="title function_">transferOwnership</span>(msg.<span class="property">sender</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getToken</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="keyword">if</span>(block.<span class="property">chainid</span> == <span class="variable constant_">GATE_CHAIN</span>) &#123;</span><br><span class="line">            <span class="title class_">Token</span>(tokenA).<span class="title function_">transfer</span>(faucet, <span class="number">100</span> ether);</span><br><span class="line">            <span class="title class_">Token</span>(tokenB).<span class="title function_">transfer</span>(faucet, <span class="number">100</span> ether);</span><br><span class="line">            <span class="title class_">Token</span>(tokenC).<span class="title function_">transfer</span>(faucet, <span class="number">100</span> ether);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">solve</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(block.<span class="property">chainid</span> == <span class="variable constant_">CODE_CHAIN</span>, <span class="string">&quot;Can be solved only on CODE CHAIN&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(<span class="title class_">Token</span>(tokenA).<span class="title function_">balanceOf</span>(msg.<span class="property">sender</span>) &gt;= <span class="variable constant_">DEX_SUPPLY</span> * <span class="number">2</span>, <span class="string">&quot;Not enough USDC&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(<span class="title class_">Token</span>(tokenB).<span class="title function_">balanceOf</span>(msg.<span class="property">sender</span>) &gt;= <span class="variable constant_">DEX_SUPPLY</span> * <span class="number">2</span>, <span class="string">&quot;Not enough PURR&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(<span class="title class_">Token</span>(tokenC).<span class="title function_">balanceOf</span>(msg.<span class="property">sender</span>) &gt;= <span class="variable constant_">DEX_SUPPLY</span> * <span class="number">2</span>, <span class="string">&quot;Not enough MOODENG&quot;</span>);</span><br><span class="line">        isSolved = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DEX</code> is the core contract in this challenge. The main duty for a DEX (Decentralized Exchange) is the exchange service, where users can exchange some <code>tokenA</code> to <code>tokenB</code> according to current exchange rate. </p>
<p>Two <code>DEX</code> are deployed on different chains in this challenge. If one <code>DEX</code> exhausts a certain token, it‚Äôll initiate a transfer request for more tokens with the other <code>DEX</code>, which actually completes a cross-chain exchange. <code>Message</code> related codes are used to handle cross-chain requirements, kinda cool.</p>
<p>Here comes the core logic of <code>DEX</code> contract.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_swap</span>(<span class="params">address <span class="keyword">from</span>, address receiver, uint256 amount, bytes32 srcToken, bytes32 dstToken</span>) internal &#123;</span><br><span class="line">    uint256 rate = <span class="title function_">_getRate</span>(srcToken, dstToken);</span><br><span class="line">    <span class="title class_">Token</span> srcTokenAddress = <span class="title class_">Token</span>(tokenMapping[srcToken]);</span><br><span class="line">    <span class="title class_">Token</span> dstTokenAddress = <span class="title class_">Token</span>(tokenMapping[dstToken]);</span><br><span class="line">    uint256 targetAmount = amount * rate / <span class="number">1e6</span>;</span><br><span class="line">    uint256 diffAmount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(dstTokenAddress.<span class="title function_">balanceOf</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>)) &lt; targetAmount) &#123;</span><br><span class="line">        diffAmount = targetAmount - dstTokenAddress.<span class="title function_">balanceOf</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>));</span><br><span class="line">        targetAmount = dstTokenAddress.<span class="title function_">balanceOf</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>));</span><br><span class="line">        amount = <span class="title function_">_getRate</span>(dstToken, srcToken) * targetAmount / <span class="number">1e6</span>;</span><br><span class="line">        emit <span class="title class_">MessageSent</span>(<span class="title class_">Message</span>(&#123;</span><br><span class="line">            <span class="attr">messageType</span>: <span class="title class_">MessageType</span>.<span class="property">LiquidityRequest</span>,</span><br><span class="line">            <span class="attr">from</span>: <span class="title function_">address</span>(<span class="variable language_">this</span>),</span><br><span class="line">            <span class="attr">receiver</span>: receiver,</span><br><span class="line">            <span class="attr">srcToken</span>: srcToken,</span><br><span class="line">            <span class="attr">dstToken</span>: dstToken,</span><br><span class="line">            <span class="attr">srcChainId</span>: block.<span class="property">chainid</span>,</span><br><span class="line">            <span class="attr">dstChainId</span>: block.<span class="property">chainid</span> == <span class="variable constant_">CODE_CHAIN</span> ? <span class="variable constant_">GATE_CHAIN</span> : <span class="variable constant_">CODE_CHAIN</span>,</span><br><span class="line">            <span class="attr">amount</span>: diffAmount</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">from</span> != <span class="title function_">address</span>(<span class="variable language_">this</span>)) &#123;</span><br><span class="line">        srcTokenAddress.<span class="title function_">transferFrom</span>(<span class="keyword">from</span>, <span class="title function_">address</span>(<span class="variable language_">this</span>), amount);</span><br><span class="line">    &#125;</span><br><span class="line">    dstTokenAddress.<span class="title function_">transfer</span>(receiver, targetAmount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There exists a small vuln in the cross-chain process. Before <code>DEX</code> initiates the request, it recalculates the <code>amount = _getRate(dstToken, srcToken) * targetAmount / 1e6</code> first. Due to integer division, this may cause a loss of precision. If the <code>targetAmount</code> is accurately controlled, we can set <code>amount</code> to 0 and get paid for free.</p>
<p>Therefore, we control the number of <code>tokenA/B/C</code> first through the exchange service, and then trigger this vuln via a cross-chain request. By repeating this process several times we can solve this challenge. ‚Äì&gt;</p>
]]></content>
      <tags>
        <tag>DFA</tag>
      </tags>
  </entry>
  <entry>
    <title>fairy-ring::Dice CTF 2025 Qual</title>
    <url>/2025/04/01/dicectf2025/</url>
    <content><![CDATA[<p>Time: 2025.03.29-31 (online)</p>
<h2 id="fairy-ring-7-solves"><a href="#fairy-ring-7-solves" class="headerlink" title="fairy-ring (7 solves)"></a>fairy-ring (7 solves)</h2><p><a href="https://priv.pub/posts/dicectf-quals-2025/#fairy-ring">Original Writeup</a></p>
<p><a href="https://github.com/defund/ctf/tree/master/dicectf-quals-2025/fairy-ring">https://github.com/defund/ctf/tree/master/dicectf-quals-2025/fairy-ring</a></p>
<blockquote>
<ul>
<li><a href="fairy-ring/server.py">server.py</a></li>
<li><a href="https://github.com/mjosaarinen/uov-py/tree/main">https://github.com/mjosaarinen/uov-py/tree/main</a></li>
<li><ul>
<li><a href="fairy-ring/uov.py">uov.py</a></li>
</ul>
</li>
<li><ul>
<li><a href="fairy-ring/uov_trapdoor.py">uov_trapdoor.py</a></li>
</ul>
</li>
<li>keys</li>
</ul>
</blockquote>
<p>Also check this <a href="https://priv.pub/posts/rainbow-attack/">defund‚Äôs gift</a> and this <a href="https://eprint.iacr.org/2020/1343.pdf">Improved cryptanalysis of UOV and Rainbow</a>!</p>
<p>A good chance to learn more about MQ and UOV.</p>
<h3 id="Multivariate-Quadratic"><a href="#Multivariate-Quadratic" class="headerlink" title="Multivariate Quadratic"></a>Multivariate Quadratic</h3><p>A Multivariate Quadratic (MQ) is a polynomial in $n$ variables over $\mathbb{F_q}$: $f(x_1, ‚Ä¶, x_n) &#x3D; \sum_i^n \sum_j^n a_{i,j} x_i x_j + \sum_i^n b_{i} x_i + c$. We can represent it with matrix: $f(\vec{x}) &#x3D; \vec{x}^\top  A  \vec{x} + \vec{b}^\top  \vec{x} + c$.</p>
<p>A Multivariate Quadratic Map $\mathcal{F}: \mathbb{F_q^n} \rightarrow \mathbb{F_q^m}$ is a collection of such polynomials $f_1, ‚Ä¶, f_m$ where:<br>$$\mathcal{F}(\vec{x}) &#x3D; (f_1(\vec{x}), ‚Ä¶, f_m(\vec{x}))$$</p>
<p>Multivariate Quadratic Problem (MQP): Given arbitrary $\mathcal{F}: \mathbb{F_q^n} \rightarrow \mathbb{F_q^m}$ and $\vec{t} \in \mathbb{F_q^m}$, it‚Äôs NP-hard to find $\mathcal{F}(\vec{s}) &#x3D; \vec{t}$. </p>
<h3 id="Polar-Form"><a href="#Polar-Form" class="headerlink" title="Polar Form"></a>Polar Form</h3><p>It‚Äôs clear that:<br>$$<br>\begin{aligned}<br>f(\vec{x} + \vec{y}) &amp;&#x3D; (\vec{x} + \vec{y})^\top  A  (\vec{x} + \vec{y}) + \vec{b}^\top  (\vec{x} + \vec{y}) + c \\<br>&amp;&#x3D; f(\vec{x}) + f(\vec{y}) - f(\vec{0}) + \vec{x}^\top  (A + A^\top)  \vec{y} \\<br>\end{aligned}<br>$$</p>
<p>And we have the polar form: $f‚Äô(\vec{x}, \vec{y}) &#x3D; \vec{x}^\top  (A + A^\top)  \vec{y} &#x3D; f(\vec{x} + \vec{y}) - f(\vec{x}) - f(\vec{y}) + f(\vec{0})$. This also works for a Multivariate Quadratic Map: $\mathcal{F}‚Äô(\vec{x}, \vec{y}) &#x3D; \mathcal{F}(\vec{x} + \vec{y}) - \mathcal{F}(\vec{x}) - \mathcal{F}(\vec{y}) + \mathcal{F}(\vec{0})$.</p>
<h3 id="Words"><a href="#Words" class="headerlink" title="Words"></a>Words</h3><p>We mainly focus on the quadratic part of a MQ, which serves as the core of the hardness. So we usually have $f(\vec{x}) &#x3D; \sum_i^n \sum_j^n a_{i,j} x_i x_j &#x3D; \vec{x}^\top  A  \vec{x}$. One can always find a symmertric $A$ since $\vec{x}^\top  A  \vec{x} &#x3D; \vec{x}^\top  A^\top  \vec{x} &#x3D; \vec{x}^\top  (\frac{A + A^\top}{2})  \vec{x}$. We can further simplify $A$ into a upper triangular matrix, which is more intuitive and leads to less storage overhead.</p>
<p>And the polar form: $f‚Äô(\vec{x}, \vec{y}) &#x3D; f(\vec{x} + \vec{y}) - f(\vec{x}) - f(\vec{y})$.</p>
<h3 id="UOV-Signature"><a href="#UOV-Signature" class="headerlink" title="UOV Signature"></a>UOV Signature</h3><p>The Unbalanced Oil and Vinegar (UOV) scheme is a signature scheme based on MQ.</p>
<p>First we construct an easy-to-solve MQ $f(\vec{x}) &#x3D; \sum_i^n \sum_{j &gt; m}^n a_{i,j} x_i x_j$. Here we call oil variables $\vec{x_o} &#x3D; (x_1, ‚Ä¶, x_m, 0, ‚Ä¶, 0)$ and vinegar variables $\vec{x_v} &#x3D; (0, ‚Ä¶, 0, x_{m+1}, ‚Ä¶, x_{m+v})$ (where $n &#x3D; m+v$), and it‚Äôs clear that $\mathcal{F}$ is linear to $\vec{x_o}$. By randomly choosing $\vec{x_v}$, one can solve the linear system to get the answer.</p>
<p>Matrix form:<br>$$<br>A &#x3D; \begin{bmatrix}<br>O_{m \times m} &amp; B_{m \times v} \\<br>O_{v \times m} &amp; C_{v \times v}<br>\end{bmatrix}<br>\rightarrow<br>(\vec{x_o} + \vec{x_v})^\top  A  (\vec{x_o} + \vec{x_v}) &#x3D; \vec{x_o}‚Äô^\top  B  \vec{x_v}‚Äô + \vec{x_v}‚Äô^\top  C  \vec{x_v}‚Äô<br>$$</p>
<p>Polar form:<br>$$<br>\mathcal{F}(\vec{x_o}) &#x3D; \vec{0} \rightarrow \mathcal{F}(\vec{x_o} + \vec{x_v}) &#x3D; \mathcal{F}‚Äô(\vec{x_o}, \vec{x_v}) + \mathcal{F}(\vec{x_v})<br>$$</p>
<p>In UOV, we use $\mathcal{F}$ as the private key and the public key is $\mathcal{P} &#x3D; \mathcal{F} \circ \mathcal{T}$, where $\mathcal{T}$ is an invertable linear transformation. For a message $m$, the signature $\vec{s}$ satisfies $\mathcal{P}(\vec{s}) &#x3D; \mathcal{Hash}(m)$. The signer just solves $\mathcal{F}(\vec{x}) &#x3D; \mathcal{Hash}(m)$ and computes $\vec{s} &#x3D; \mathcal{T}^{-1}(\vec{x})$.</p>
<p>The main idea is to find a linear space $\mathcal{O}$ with rank $r \geq m$, and for all $\vec{o} \in \mathcal{O}$ we have $\mathcal{P}(\vec{o}) &#x3D; \vec{0}$. It‚Äôs also worth mentioning that for any valid signature $\vec{s}$, $\vec{s} + \mathcal{O}$ is still valid.</p>
<h3 id="Ring-Signature"><a href="#Ring-Signature" class="headerlink" title="Ring Signature"></a>Ring Signature</h3><p>In this challenge, we have a ring signature scheme based on UOV. Any one of the $n$ users can generate a signature on behalf of the group, and no one can distinguish the signer.</p>
<ul>
<li>$\mathcal{Setup}:$ Each user generates a UOV key pair $(\mathcal{P}, \mathcal{F})$.</li>
<li>$\mathcal{Sign}:$ For message $m$, user $a$ randomly chooses $(\vec{x_1}, ‚Ä¶, \vec{x_{a-1}}, \vec{x_{a+1}},‚Ä¶, \vec{x_n})$ and compute $\vec{t} &#x3D; \mathcal{Hash}(m) - \sum_{i \neq a}^n \mathcal{P_i}(\vec{x_i})$. Then user $a$ solve $\mathcal{P_a}(\vec{x_a}) &#x3D; \vec{t}$ with the private key $\mathcal{F_a}$. The signature is $(\vec{x_1}, ‚Ä¶, \vec{x_n})$.</li>
<li>$\mathcal{Verify}:$ Check whether $\mathcal{Hash}(m) &#x3D; \sum_{i}^n \mathcal{P_i}(\vec{x_i})$ satisfies.</li>
</ul>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>The solution is easy but elegant.</p>
<p>We can pick the same public key more than once, and actually it‚Äôs possible for us to forge a valid signature for any message (yeah it‚Äôs completely broken). Consider a public key $\mathcal{P}$, we have</p>
<p>$$\vec{t} &#x3D; \mathcal{P}(\vec{x} + \vec{y}) - \mathcal{P}(\vec{x}) &#x3D; \mathcal{P}‚Äô(\vec{x}, \vec{y}) + \mathcal{P}(\vec{y})$$</p>
<p>Here $\vec{t}$ is linear to $\vec{x}$, that‚Äôs all we need to solve this challenge. For a given message $m$, we can pick the same public key $\mathcal{P}$ twice, then randomly choose a $\vec{y}$ and find the solution $\mathcal{Hash}(m) &#x3D; \mathcal{P}(\vec{x} + \vec{y}) - \mathcal{P}(\vec{x})$ (it‚Äôs the same for ‚Äò$+$‚Äô and ‚Äò$\oplus$‚Äô on $\mathbb{F_{2^8}}$). And $(\vec{x} + \vec{y}, \vec{x})$ is a valid signature.</p>
<p><a href="fairy-ring/exp.py">exp.py</a></p>
]]></content>
      <tags>
        <tag>UOV</tag>
      </tags>
  </entry>
  <entry>
    <title>Hitcon CTF 2025</title>
    <url>/2025/08/25/hitconctf2025/</url>
    <content><![CDATA[<p>I played Hitcon CTF last weekend with r3kapig, enjoyed.</p>
<h2 id="MRSA"><a href="#MRSA" class="headerlink" title="MRSA"></a>MRSA</h2><blockquote>
<ul>
<li><a href="MRSA/chall.py">chall.py</a></li>
</ul>
</blockquote>
<p>In this challenge, we need to recover a $k \cdot k$ small (8bit) secret matrix $M$ with $C &#x3D; M^e \pmod{n}$, where $n$ is omitted.</p>
<h3 id="Our-Solution"><a href="#Our-Solution" class="headerlink" title="Our Solution"></a>Our Solution</h3><p>We implemented our solution based on the truth that $M \cdot C &#x3D; C \cdot M \pmod{n}$, which gives us $k \cdot k$ equations about $M$. Take a certain position $(i, j)$ as an example: </p>
<p>$$<br>\begin{aligned}<br>(M \cdot C)[i, j] &amp;&#x3D; (C \cdot M)[i, j] \pmod{n} \\<br>M[i] \cdot C^T[j] &amp;&#x3D; C[i] \cdot M^T[j] \pmod{n} \\<br>&amp;\Rightarrow \\<br>t_{i, j} \cdot n &amp;&#x3D; M[i] \cdot C^T[j] - C[i] \cdot M^T[j]<br>\end{aligned}<br>$$</p>
<p>And we can construct an equation on $\mathbb{Z}$ with two separate positions $(i_0, j_0)$ and $(i_1, j_1)$:</p>
<p>$$<br>t_{i_1, j_1} \cdot (M[i_0] \cdot C^T[j_0] - C[i_0] \cdot M^T[j_0]) &#x3D; t_{i_0, j_0} \cdot (M[i_1] \cdot C^T[j_1] - C[i_1] \cdot M^T[j_1])<br>$$</p>
<p>Here $t$ is a small value, since $M$ is very small. So we can combine $t \cdot M[i]$ as a secret and solve it by applying <code>LLL</code> to the kernel space. For an optimized strategy, we can pick $i_0 &#x3D; i_1 &#x3D; i$ and reduce the unknown variables from $k \cdot 4 &#x3D; 64$ to $k \cdot 3 &#x3D; 48$, that is:</p>
<p>$$<br>(t_{i, j_1} \cdot M[i]) \cdot C^T[j_0] - (t_{i, j_0} \cdot M[i]) \cdot C^T[j_1] &#x3D; C[i] \cdot (t_{i, j_1} \cdot M^T[j_0] - t_{i, j_0} \cdot M^T[j_1])<br>$$</p>
<p>With the equation, we can find $(t \cdot M[i]) \Rightarrow M[i]$, and solve $M$ row by row. </p>
<p>It‚Äôs worth mentioning that for any position $(i, j)$, $(M[i, i], M[j, j])$ will always be eliminated in the equation. So we can only recover $M$ without $M[i, i]$. But it‚Äôs enough for us to brute force 3 bytes to get the flag.</p>
<blockquote>
<ul>
<li><a href="MRSA/exp.py">exp.py</a></li>
</ul>
</blockquote>
<h3 id="Other-solutions"><a href="#Other-solutions" class="headerlink" title="Other solutions"></a>Other solutions</h3><p>We can implement some new solutions with <a href="https://en.wikipedia.org/wiki/Cayley%E2%80%93Hamilton_theorem">Cayley-Hamiltion Theorem</a>.</p>
<blockquote>
<p>For a $k \cdot k$ matrix $M$, let $p_{M}(x) &#x3D; \Sigma_{i&#x3D;0}^{k-1} a_i \cdot x^i$ be the characteristic polynomial of $M$, we have $p_{M}(M) &#x3D; 0$.</p>
</blockquote>
<p>And this, my friend, gives us a way to find a linear expression with $[M^0, ‚Ä¶, M^{k-1}]$ for any $M^e$, since we can use $p_M(M)$ to build a quotient ring.</p>
<p>Back to the challenge, we can find $[b_0, ‚Ä¶, b_{k-1}]$ such that $C &#x3D; \Sigma_{i&#x3D;0}^{k-1} b_i \cdot M^i \pmod{n}$. Since $M^i$ is still small enough, we can costruct $k \cdot k$ HCLPs with each $C[i, j]$ and $[M^0[i, j], ‚Ä¶, M^{k-1}[i, j]]$.</p>
<h2 id="BabyLWE"><a href="#BabyLWE" class="headerlink" title="BabyLWE"></a>BabyLWE</h2><blockquote>
<ul>
<li><a href="BabyLWE/chall.py">chall.py</a></li>
</ul>
</blockquote>
<p>In this challenge we need to solve a LWE problem with a special noise distribution: $e_i$ is not small but picked from a random ternary error set $errs$ ($|errs| &#x3D; 3$).</p>
<p>Months before, me and @Á≥ñÈÜãÂ∞èÈ∏°Âùó discussed about the binary error set scenario ($|errs| &#x3D; 2$). Based on the fact that for any binary set $errs &#x3D; \{ e_0, e_1 \}$, we can always find an affine map $f(x) &#x3D; a \cdot x + b$, such that $f(errs) &#x3D; \{0, 1\}$. And this affined error vector is short enough to be obtained on the following lattice: </p>
<p>$$<br>b &#x3D; s \cdot A + e \pmod{p}<br>\Rightarrow<br>\begin{bmatrix}<br>A \\<br>b \\<br>\textbf{1}^m \\<br>p \cdot I<br>\end{bmatrix}<br>$$</p>
<p>where $\textbf{1}^m$ is an all-1 vector and $I$ is the identity matrix. With the recovered binary vector, we can learn the pick-up situations of the error vector and solve LWE in a linear system of $(s, errs)$.</p>
<p>The method also works in this challenge. We‚Äôre not able to find a strictly small vector (say binary vector) through affine map with $|errs| &gt; 2$. But it turns out that in this challenge, an affined ternary vector is short enough to be solved through <code>LLL</code>. Then we can solve LWE with the same steps above.</p>
<h2 id="Pedantic"><a href="#Pedantic" class="headerlink" title="Pedantic"></a>Pedantic</h2><blockquote>
<ul>
<li><a href="Pedantic/server.py">server.py</a></li>
</ul>
</blockquote>
<p>In this challenge we need to break a zkp protocol with bad Fiat-Shamir Transformation.</p>
<h3 id="Fiat-Shamir-Transformation"><a href="#Fiat-Shamir-Transformation" class="headerlink" title="Fiat-Shamir Transformation"></a>Fiat-Shamir Transformation</h3><p>Fiat-Shamir Transformation is a practical way to transform an interactive sigma protocol into a non-interactive version. In short, we construct a determined Random Oracle by hashing the current states, and replace the ‚Äúchallenge‚Äù generated by the verifier. You can check how <code>hash_points_to_scalars</code> is used in both <code>prove</code> and <code>verify</code> in this challenge.</p>
<p>RO is the core of the security here: we must make sure the hash function is well-constructed, and the current states are carefully selected. So, the linear structure of <code>hash_points_to_scalars</code> is definitely not a good choice. Xp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hash_points_to_scalars</span>(<span class="params">pts: <span class="built_in">list</span>[Point], n: <span class="built_in">int</span></span>):</span><br><span class="line">    s = <span class="built_in">sum</span>([hash_point(pt) <span class="keyword">for</span> pt <span class="keyword">in</span> pts]) % q</span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        ret.append(s)</span><br><span class="line">        s = (<span class="number">1337</span> * s + <span class="number">7331</span>) % q</span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>

<h3 id="Our-Solution-1"><a href="#Our-Solution-1" class="headerlink" title="Our Solution"></a>Our Solution</h3><p>The most part of the protocol remains secure due to <code>secp256k1</code>, which means we‚Äôre not able to forge a valid proof without the knowledge of <code>x</code>. But if we can predict the challenge <code>c</code> in some way, things will be a little different since we can randomly pick <code>z</code> first, and compute <code>Gr = Y*c - G*z</code>.</p>
<p>For the iteration part, we can use a fixed point:</p>
<p>$$<br>c &#x3D; a \cdot c + b \Rightarrow c &#x3D; \frac{b}{1 - a} \pmod{q}<br>$$</p>
<p>Now <code>c</code> is the same in each round, we can focus on how to construct a valid <code>Grs</code> to get the target <code>c</code>. We can generate a set of <code>zs</code> and the corresponding <code>Grs</code> first. Consider there exists a valid subset of <code>Grs</code> satisfying our target, we have:</p>
<p>$$<br>c &#x3D; \Sigma_{i} k_i \cdot \mathcal{H}(Gr_i) \pmod{q}<br>$$</p>
<p>where $k_i$ is a binary variable and $\mathcal{H}$ is the hash function <code>hash_point</code>. This is a typical knapsack problem, and we can try to find a solution with <code>LLL</code>.</p>
<h2 id="Paranoid"><a href="#Paranoid" class="headerlink" title="(*)Paranoid"></a>(*)Paranoid</h2><blockquote>
<ul>
<li><a href="Paranoid/server.py">server.py</a></li>
</ul>
</blockquote>
<p>In this challenge we need to break a zkp protocol with <strong>NOT THAT BAD</strong> Fiat-Shamir Transformation.</p>
<h3 id="Some-Discussions"><a href="#Some-Discussions" class="headerlink" title="Some Discussions"></a>Some Discussions</h3><p>For this one, we can still <strong>1)</strong> fix the <code>c</code> first, and <strong>2)</strong> construct a valid <code>Grs</code> to get <code>c</code>. But this time we‚Äôre not able to find a fixed point, so the iteration part is unavoidable. </p>
<p>In this case, we may have to fix a <code>c</code> and randomly get <code>k</code> groups of <code>Grs</code>, picking one out of each group to combine <code>c</code>. This leads to a <code>k</code>-sum problem, while wagner algorithm is an efficient way to solve it. I found a python-implemented version to use, but that‚Äôs not enough for this problem. Maybe cpp and careful optimization are necessary for this challenge ig.</p>
]]></content>
      <tags>
        <tag>LLL</tag>
      </tags>
  </entry>
  <entry>
    <title>ZZKAoK::Kalmar CTF 2025</title>
    <url>/2025/03/10/kalmarctf2025/</url>
    <content><![CDATA[<p>Time: 2025.03.09-10 (online)</p>
<p>I played with r3kapig last weekend, and we managed to solve 5 out of 8 crypto challs. </p>
<h2 id="ZZKAoK-6-solves"><a href="#ZZKAoK-6-solves" class="headerlink" title="ZZKAoK (6 solves)"></a>ZZKAoK (6 solves)</h2><blockquote>
<ul>
<li><a href="ZZKAoK/client.sage">client.sage</a></li>
<li><a href="ZZKAoK/server.py">server.py</a></li>
<li><a href="ZZKAoK/intarg.py">intarg.py</a></li>
</ul>
</blockquote>
<p>I‚Äôll explain this challenge following my path during the contest -&gt; logical confusion and nonsense.</p>
<h3 id="Zk-Proof-System"><a href="#Zk-Proof-System" class="headerlink" title="Zk Proof System"></a>Zk Proof System</h3><p>Here comes a proof system for integer factorization. Given $N$, the Prover $\mathcal{P}$ can show the knowledge of two factors $(p, q)$ satisfying $N &#x3D; p \cdot q$ to the Verifier $\mathcal{V}$, though the following constraints:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># relation to prove:</span></span><br><span class="line"><span class="comment"># p \notin &#123;-1, 1&#125;</span></span><br><span class="line"><span class="comment"># q \notin &#123;-1, 1&#125;</span></span><br><span class="line"><span class="comment"># p * q = N</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># via:</span></span><br><span class="line"><span class="comment"># a^2 - 4 &gt;= 0 &lt;=&gt; a \notin &#123;-1, 1&#125;</span></span><br><span class="line"><span class="comment"># b^2 - 4 &gt;= 0 &lt;=&gt; b \notin &#123;-1, 1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># arithmetic circuit:</span></span><br><span class="line"><span class="comment"># p * q = N</span></span><br><span class="line"><span class="comment"># a1^2 + a2^2 + a3^2 + a4^2 = p^2 - 4</span></span><br><span class="line"><span class="comment"># b1^2 + b2^2 + b3^2 + b4^2 = q^2 - 4</span></span><br></pre></td></tr></table></figure>

<p>Apparently $\mathcal{P}$ is able to compute a valid proof if and only if he knows the factors.</p>
<p>But we don‚Äôt want to reveal any other information about the factors (thus zeor-knowledge), so $\mathcal{P}$ CANNOT just send the values to $\mathcal{V}$. Instead, we randomly choose small prime $p_i$ and check the constraints on $\mathbb{F_{p_i}}$. Our proof is more reliable with more primes chosen, as analyzed in the challenge:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TOTAL_PRIME_BITS = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> PRIMES:</span><br><span class="line">    TOTAL_PRIME_BITS += p.bit_length() - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">BITS = <span class="number">50_000</span>                              <span class="comment"># maximum norm, bits</span></span><br><span class="line">SECP = <span class="number">256</span>                                 <span class="comment"># \secpar</span></span><br><span class="line">RATE = (TOTAL_PRIME_BITS + BITS - <span class="number">1</span>)//BITS <span class="comment"># rate</span></span><br><span class="line">SECB = RATE.bit_length() - <span class="number">1</span>               <span class="comment"># security bits per query</span></span><br><span class="line">QUERIES = (SECP + SECB - <span class="number">1</span>) // SECB        <span class="comment"># total number of queries</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(PRIMES) == <span class="number">1</span> &lt;&lt; NUML</span><br></pre></td></tr></table></figure>

<blockquote>
<p>In fact $\mathcal{P}$ leaks $secret \pmod{p_i}$ in this process, so this is technically not that ‚Äúzero-knowledge‚Äù.</p>
</blockquote>
<p>For a secure proof system, we must make sure $\mathcal{P}$ computed the proof correctly, rather than giving a random answer on \mathbb{F_{p_i}}$. Here is how we do:</p>
<ol>
<li>$\mathcal{P}$ makes commitments on secret values.</li>
<li>$\mathcal{V}$ chooses some primes $p_i \in PRIMES$.</li>
<li>$\mathcal{P}$ computes constraints inputs and outputs values on $\mathbb{F_{p_i}}$.</li>
<li>$\mathcal{V}$ check the validity on \mathbb{F_{p_i}}$.</li>
</ol>
<h3 id="Merkle-Tree"><a href="#Merkle-Tree" class="headerlink" title="Merkle Tree"></a>Merkle Tree</h3><p>With Commitment Scheme, we ensure that $\mathcal{P}$ cannot modify input values in the subsequnt proof steps. Here the challenge uses Merkle Tree Commitment, which is suitable for set commitment and membership open&#x2F;proof.</p>
<ol>
<li>$\mathcal{P}$ computes $secret \pmod{p_i}$ on all $p_i \in PRIMES$, storing in a list.</li>
<li>$\mathcal{P}$ generates a Merkle Tree on the list, using Tree Root as the commitment.</li>
<li>For a chosen prime $p_i$, $\mathcal{P}$ opens the commitment by providing the Merkle Path of $secret \pmod{p_i}$.</li>
</ol>
<p>Then we can make sure $\mathcal{P}$ is using $secret \pmod{p_i}$ with the committed $secret$.</p>
<h3 id="NIZK"><a href="#NIZK" class="headerlink" title="NIZK"></a>NIZK</h3><p>What we have is a interactive proof system. For a non-interactive one, we need $\mathcal{P}$ to generate challenge data on his own while ensuring security. We introduce a <code>transcript</code> structure:</p>
<ul>
<li>The internal state of the transcript gets changes every time $\mathcal{P}$ performs operations such as commit and evaluate.</li>
<li>$\mathcal{P}$ generates random values based on the internal state of the transcript as challenge data provided from $\mathcal{V}$.</li>
</ul>
<p>The <code>transcript</code> binds its internal state to the proof operations, while its subsequent output is determined but unpredictable. This is an important structure in non-interactive zero-knowledge proofs. Check <a href="https://en.wikipedia.org/wiki/Fiat%E2%80%93Shamir_heuristic">Fiat-Shamir Heuristic</a>.</p>
<p>And here comes our NIZK:</p>
<p>$\mathcal{P}$:</p>
<ol>
<li>$\mathcal{P}$ makes commitments on secret values.</li>
<li>$\mathcal{P}$ gets some primes $p_i \in PRIMES$ from <code>transcripts</code>.</li>
<li>$\mathcal{P}$ opens the commitments on the chosen $p_i$.</li>
<li>$\mathcal{P}$ computes constraints inputs and outputs values on $\mathbb{F_{p_i}}$.</li>
</ol>
<p>$\mathcal{V}$:</p>
<ol>
<li>$\mathcal{V}$ repeats the whole process to get the status of the <code>transcript</code>.</li>
<li>$\mathcal{V}$ checks the validity of the opens.</li>
<li>$\mathcal{V}$ verify the validity of the proof.</li>
</ol>
<p>In addition to the target constraints, we need to add a new constraint binding all the commitments (a linear one is ok). </p>
<h3 id="Vuln1-Unintended"><a href="#Vuln1-Unintended" class="headerlink" title="Vuln1 (Unintended)"></a>Vuln1 (Unintended)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Merkle Tree Path Verification</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">root: <span class="built_in">str</span>, proof: <span class="built_in">list</span>, pos: <span class="built_in">int</span>, size: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(proof) &gt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(proof) &lt; <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    lvls = <span class="built_in">len</span>(proof) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">1</span> &lt;&lt; lvls == size</span><br><span class="line"></span><br><span class="line">    leaf = proof[<span class="number">0</span>]</span><br><span class="line">    node = sha256(leaf)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, lvls+<span class="number">1</span>):</span><br><span class="line">        (dirc, sibl) = proof[i]</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">isinstance</span>(sibl, <span class="built_in">str</span>)</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">isinstance</span>(dirc, <span class="built_in">int</span>)</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(sibl) == <span class="number">64</span></span><br><span class="line">        <span class="keyword">assert</span> dirc <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> dirc == <span class="number">0</span>:</span><br><span class="line">            node = sha256(node + sibl)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = sha256(sibl + node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> node == root</span><br><span class="line">    <span class="keyword">return</span> leaf</span><br></pre></td></tr></table></figure>

<p>We can find that the verification for Merkle Tree Path does not check whether the <code>path</code> corresponds to the <code>pos</code>, so we can choose any valid <code>path</code> from the tree when opening. My strategy is as follows:</p>
<ol>
<li>$p &#x3D; N, q &#x3D; 1$</li>
<li>$four(a_1, a_2, a_3, a_4) &#x3D; p^2 - 4$</li>
<li>$(b_1, b_2, b_3, b_4) &#x3D; (rand, rand, rand, rand)$</li>
</ol>
<p>For each $pos$, we should find three positions $(i, j, k)$ where $(b_2, b_3, b_4)$ can be opened to satisfy the constraints. I just iterate through $i$ and solve the following equations:</p>
<ol>
<li>$b_3^2 + b_4^2 &#x3D; r \pmod{p_i}$</li>
<li>$f_0 \cdot b_3 + f_1 \cdot b_4 &#x3D; v \pmod{p_i}$</li>
</ol>
<p>After finding possible solutions, we can then check if there are positions $(j, k)$ that satisfy the solutions.</p>
<h3 id="Vuln2-Intended"><a href="#Vuln2-Intended" class="headerlink" title="Vuln2 (Intended)"></a>Vuln2 (Intended)</h3><p>The second vuln lies in the final constraint over all the commitments. This time our strategy is more direct:</p>
<ol>
<li>$p &#x3D; N, q &#x3D; 1$</li>
<li>$four(a_1, a_2, a_3, a_4) &#x3D; p^2 - 4$</li>
<li>find $(b_1, b_2, b_3, b_4)$ such that $\forall p_i \in PRIMES \rightarrow (b_1, b_2, b_3, b_4) &#x3D; (-1, -1, -1, 0) \pmod{p_i}$</li>
</ol>
<p>Or something else, satisfying $b_1^2 + b_2^2 + b_3^2 + b_4^2 &#x3D; -3 \pmod{p_i}$. It turns out that one can easily find a solution with CRT, which will be very large. The value of the last constraints (linear combined commitments) is too large to pass the following code in <code>Verifier</code>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Verifier</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">value</span>(<span class="params">self</span>):</span><br><span class="line">        value = <span class="built_in">next</span>(<span class="variable language_">self</span>.vals)</span><br><span class="line">        <span class="keyword">assert</span> - <span class="number">2</span>**BITS &lt; value &lt; <span class="number">2</span>**BITS</span><br><span class="line">        <span class="variable language_">self</span>.tx.value(value)</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>

<p>Actually $\mathcal{V}$ does NOT check how many commitments are used, and the verification for the last constraint just sum all of them up. So we can add an extra ‚Äúunauthorized‚Äù commitment to control the value to zero. Since <code>transcript</code> is unchanged, we can first get both the constraint and all the $p_i$, and then construct out commitment. </p>
<p>During the contest we did notice some strange implementations in the challenge.</p>
<table>
<thead>
<tr>
<th><img src="/2025/03/10/kalmarctf2025/images/1.png" alt="image"></th>
<th><img src="/2025/03/10/kalmarctf2025/images/2.png" alt="image"></th>
</tr>
</thead>
</table>
<p>But nobody gave it a further analysis XD</p>
]]></content>
      <tags>
        <tag>ZKP</tag>
      </tags>
  </entry>
  <entry>
    <title>SECCON CTF 2025 Final (Tokyo, JapanüáØüáµ)</title>
    <url>/2025/03/04/secconctffinal2025/</url>
    <content><![CDATA[<p>Time: 2025.03.01-02 (onsite)</p>
<p><a href="https://github.com/SECCON/SECCON13_final_CTF/tree/main/crypto">https://github.com/SECCON/SECCON13_final_CTF/tree/main/crypto</a></p>
<p>I participated SECCON 13th Final as a member of P1G SEKAI this weekend, and we finally got 4th among international teams.</p>
<p><img src="/2025/03/04/secconctffinal2025/images/2.jpg" alt="rank"></p>
<p>Nice crypto challenges, and I solved 3 out of 4. IF ONLY I‚Äôd ever taken some time to study UOV.</p>
<p><img src="/2025/03/04/secconctffinal2025/images/1.png" alt="solve"></p>
<p>Or maybe I was just too nervous.</p>
<p>XO</p>
<h2 id="RSA-8-solves"><a href="#RSA-8-solves" class="headerlink" title="RSA+ (8 solves)"></a>RSA+ (8 solves)</h2><blockquote>
<ul>
<li><a href="RSA+/task.py">task.py</a></li>
</ul>
</blockquote>
<p>It turns out that we can send two composite number $(p, q)$, both smaller than 512 bits. Then we can just find all the solutions on $p_i$ and combine them with CRT.</p>
<blockquote>
<p>solution: <a href="RSA+/exp.py">exp.py</a></p>
</blockquote>
<p>I believe there exists a better way though.</p>
<h2 id="DLP-7-solves"><a href="#DLP-7-solves" class="headerlink" title="DLP+ (7 solves)"></a>DLP+ (7 solves)</h2><blockquote>
<ul>
<li><a href="DLP+/task.py">task.py</a></li>
</ul>
</blockquote>
<p>A simple idea is that we try to control $g^x$ (or $h^x$) to be small. Then we can get $h^x$ with some bruteforce and solve DLP to get $x$. I found some luck on Mersenne Prime $p &#x3D; 2^n - 1$, where $g^x \pmod{p}$ is very small. Finally I chose M2281 for effective DLP solver. </p>
<p>Which took me a lot of time and luck, definitely NOT that effective.</p>
<blockquote>
<p>solution: <a href="DLP+/exp.py">exp.py</a></p>
</blockquote>
<p>@Sceleri and @soon_haari used $p &#x3D; 2^a \cdot 3^b + 1$. It does make more sense since $g &#x3D; 2^{a-1} \cdot 3^b$ and $h &#x3D; 2^a \cdot 3^{b-1}$ (same in our solution). But I donot want to go through it again so just let it go.</p>
<p><img src="/2025/03/04/secconctffinal2025/images/3.png" alt="image"></p>
<h2 id="hell-summon-6-solves"><a href="#hell-summon-6-solves" class="headerlink" title="hell_summon (6 solves)"></a>hell_summon (6 solves)</h2><blockquote>
<ul>
<li><a href="hell_summon/task.py">task.py</a></li>
</ul>
</blockquote>
<p>I spent the whole afternoon day 1 on this one.</p>
<p>We have 42 pairs of $(m_i, c_i &#x3D; r \cdot (m_i  \oplus H) + e_i \pmod{p})$, where $e_i$ is due to the truncation. We rewrite $m_i \oplus H$ as $\Sigma_{j&#x3D;0}^{39} (m_{i, j} + H_{j} - 2 \cdot m_{i, j} \cdot H_{j}) \cdot 2^{j}$. </p>
<p>$$\Rightarrow \Sigma_{j&#x3D;0}^{39} r \cdot H_{j} \cdot ((1 - 2 \cdot m_{i, j}) \cdot 2^{j}) + r \cdot m_i  + e_i \pmod{p}$$</p>
<p>Orthogonal Lattice seems to be an adorable choice, and it worked well. On the first attempt I found one short vector $v$ where $\vec{v} \cdot \vec{c} &#x3D; \vec{v} \cdot \vec{e} \pmod{p}$, and it‚Äôs small enough to omit $p$. But I didn‚Äôt manage to solve $\vec{e}$.</p>
<p>On another attempt at midnight, I used vectors $(v_0, v_1)$ orthogonal to $\Sigma_{j&#x3D;0}^{39} r \cdot H_{j} \cdot ((1 - 2 \cdot m_{i, j}) \cdot 2^{j})$. Then we have two equations $r \cdot (\vec{v_i} \cdot \vec{m}) + \vec{v_i} \cdot \vec{e} \pmod{p}$, where $\vec{v_i} \cdot \vec{e}$ is small. Now we can solve it as a simple HNP.</p>
<blockquote>
<p>solution: <a href="hell_summon/exp.py">exp.py</a></p>
</blockquote>
<p>Definitely not a pleasing code but whatever.</p>
<h2 id="x-x-4-solves"><a href="#x-x-4-solves" class="headerlink" title="*x_x (4 solves)"></a>*x_x (4 solves)</h2><blockquote>
<ul>
<li><a href="x_x/task.sage">task.sage</a></li>
</ul>
</blockquote>
<p>Working on it. UOV and sth bluhbluhbluh.</p>
<h2 id="In-Japan"><a href="#In-Japan" class="headerlink" title="In Japan"></a>In Japan</h2><p>My first time to Japan, also my first time abroad. Not bad actually.</p>
<table>
<thead>
<tr>
<th><img src="/2025/03/04/secconctffinal2025/images/seccon.jpg" alt="seccon"></th>
<th><img src="/2025/03/04/secconctffinal2025/images/view.jpg" alt="view"></th>
<th><img src="/2025/03/04/secconctffinal2025/images/food.jpg" alt="food"></th>
</tr>
</thead>
</table>
<p>My teammates are very strong! Glad to work with them XD<br>And also great to meet many friends from P1G SEKAI.</p>
<p><img src="/2025/03/04/secconctffinal2025/images/view1.jpg" alt="view1"></p>
<table>
<thead>
<tr>
<th><img src="/2025/03/04/secconctffinal2025/images/view2.jpg" alt="view2"></th>
<th><img src="/2025/03/04/secconctffinal2025/images/view3.jpg" alt="view3"></th>
</tr>
</thead>
</table>
<p>Sincere thanks to @crazyman :D (Wish I could go to Mt. Fuji.)<br>I realy enjoyed Tokyo. It‚Äôd be better if I can hang out for one or two two more days.</p>
]]></content>
      <tags>
        <tag>LLL</tag>
        <tag>UOV</tag>
      </tags>
  </entry>
  <entry>
    <title>Yet another story about Sagemath environment</title>
    <url>/2025/07/23/sageenv/</url>
    <content><![CDATA[<p>For some reasons, I reconfigured my Sagemath environment recently. This post shares my tips based on my experiences these days.</p>
<p>For beginners, I‚Äôm sure this is helpful. But most of you crypto players are no strangers to Sagemath - some of you are experts ig. In that case, I hope you‚Äôll still find something interesting here :D</p>
<p>Our main targets:</p>
<ol>
<li>(Basic) Use Sagemath in VS Code, with Syntax Parsing and other helps.</li>
<li>Integrating external python packages into Sagemath.</li>
<li>Virtual Environment for Sagemath.</li>
</ol>
<h2 id="Run-sage-√ó-Import-sage-‚àö"><a href="#Run-sage-√ó-Import-sage-‚àö" class="headerlink" title="Run sage √ó; Import sage ‚àö"></a>Run <code>sage</code> √ó; Import <code>sage</code> ‚àö</h2><p>Sagemath supports many special syntaxes for simplicity and convenience. Take the following code as an example, you can use it directly in a console or write it to a <code>main.sage</code> and run it with <code>sage main.sage</code>. Typically, it is least efficient to run code in a console.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.sage</span></span><br><span class="line">R.&lt;x&gt; = ZZ[]</span><br><span class="line">f = x^<span class="number">2</span> - <span class="number">16</span></span><br><span class="line"><span class="built_in">print</span>(f.roots())</span><br><span class="line"><span class="comment"># [(4, 1), (-4, 1)]</span></span><br></pre></td></tr></table></figure>

<p>But, as we all know, Sagemath is essentially python-style code, and we can use it exactly as python. In this case, you can import <code>sage</code> like a package and run the code with Sagemath‚Äôs built-in python interpreter as <code>sage -python main.py</code>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line">R, x = PolynomialRing(ZZ, <span class="string">&#x27;x&#x27;</span>).objgen()</span><br><span class="line">f = x**<span class="number">2</span> - <span class="number">16</span></span><br><span class="line"><span class="built_in">print</span>(f.roots())</span><br><span class="line"><span class="comment"># [(4, 1), (-4, 1)]</span></span><br></pre></td></tr></table></figure>

<p>What are the benefits of this? </p>
<p>As mentioned before, Sagemath supports its own syntax system. When implementing python code, the meaning of some code is implicitly changed. For example, sagemath will use its own type by default for numbers. Another common example is the <code>^</code> symbol in sagemath, which is equivalent to <code>**</code> in python. However, <code>^</code> is used in python for <code>xor</code> computation, for which you will have to use <code>^^</code> in sagemath instead.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">233</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(a), a.bit_length())</span><br><span class="line"><span class="built_in">print</span>(a^<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;class &#x27;int&#x27;&gt; 8</span></span><br><span class="line"><span class="string">235</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(a), a.nbits())</span><br><span class="line"><span class="built_in">print</span>(a^<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;class &#x27;sage.rings.integer.Integer&#x27;&gt; 8</span></span><br><span class="line"><span class="string">54289</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>In this case, running your code (especially external python packages or projects) directly with Sagemath can easily have an obscure effect on type identification, function calls, etc. This is intolerable for me, so I highly recommend the python-style solution. </p>
<p>I don‚Äôt know the exact working mechanism in Sagemath, but this works perfectly: for any data type, function, syntax in Sagemath, you can always find the corresponding python code. In fact, you can always find a <code>main.sage.py</code> after you run <code>sage main.sage</code>, which contains the python-version of your Sagemath codes.</p>
<p>The advantage is that if you implenemt your code entirely in python style, you can introduce python-related tools such as syntax highlighting, which we‚Äôll cover later.</p>
<p>For efficiency, I don‚Äôt think there is a significant difference between the two ways. But if you wanna run sage-independent python code, using a python interpreter (not the one in Sagemath) directly is a more efficient choice.</p>
<h2 id="External-Python-Packages"><a href="#External-Python-Packages" class="headerlink" title="External Python Packages"></a>External Python Packages</h2><p>A simple way to use external python packages is to run <code>pip install</code> in your Sagemath console. Then you can import them in your sage-style&#x2F;python-style code.</p>
<h2 id="Basic-is-Enough"><a href="#Basic-is-Enough" class="headerlink" title="Basic is Enough"></a>Basic is Enough</h2><p>Here comes my simple, basic configuration used for years.</p>
<p>I just implement my codes in VS Code and run them in the terminal with <code>sage -python main.py</code>. Of course, you can use Code Runner for some convenience (but I didn‚Äôt). The only configuration I do is Pylance, in order to get code highlighting and other tools in programming. Here, the core of the problem lies in the <strong>interpreter setting</strong>.</p>
<p>To achieve this, we can run the following code in Sagemath console. </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tested on my MacOS</span></span><br><span class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îÇ SageMath version <span class="number">10.6</span>, Release Date: <span class="number">2025</span>-03-<span class="number">31</span>                    ‚îÇ</span><br><span class="line">‚îÇ Using Python <span class="number">3.12</span><span class="number">.5</span>. <span class="type">Type</span> <span class="string">&quot;help()&quot;</span> <span class="keyword">for</span> <span class="built_in">help</span>.                       ‚îÇ</span><br><span class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line">sage: <span class="keyword">import</span> sys</span><br><span class="line">sage: sys.path</span><br><span class="line">[<span class="string">&#x27;/Applications/SageMath-10-6.app/Contents/Frameworks/Sage.framework/Versions/10.6/local/var/lib/sage/venv-python3.12.5/bin&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;/private/var/tmp/sage-10.6-current/local/var/lib/sage/venv-python3.12.5/lib/python312.zip&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;/private/var/tmp/sage-10.6-current/local/var/lib/sage/venv-python3.12.5/lib/python3.12&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;/private/var/tmp/sage-10.6-current/local/var/lib/sage/venv-python3.12.5/lib/python3.12/lib-dynload&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;/private/var/tmp/sage-10.6-current/local/var/lib/sage/venv-python3.12.5/lib/python3.12/site-packages&#x27;</span>]</span><br><span class="line">sage: cat /Applications/SageMath-<span class="number">10</span>-<span class="number">6.</span>app/Contents/Frameworks/Sage.framework/Versions/<span class="number">10.6</span>/local/var/lib/sage/venv-python3<span class="number">.12</span><span class="number">.5</span>/<span class="built_in">bin</span>/sage-python</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line">sage -python <span class="string">&quot;$@&quot;</span></span><br><span class="line">sage: </span><br></pre></td></tr></table></figure>

<p>You can find a <code>.../bin</code> path. There‚Äôll always be a <code>sage-python</code> bash file in that folder, which simply runs <code>sage -python &quot;$@&quot;</code>. If you set this file as the interpreter in your VS Code, you can parse the syntax of sage-related functions.</p>
<p><img src="/2025/07/23/sageenv/images/1.png" alt="1.png"></p>
<p>This used to be able to parse external packages, but it stopped working in my VS Code for some reason. My solution is to manually import the <code>.../site-packages</code> path in the outputs above.</p>
<p>In short, you can create the following <code>.vscode/settings.json</code> file:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;python.defaultInterpreterPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/Applications/SageMath-10-6.app/Contents/Frameworks/Sage.framework/Versions/10.6/local/var/lib/sage/venv-python3.12.5/bin/sage-python&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files.exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// this will hide the following setting files</span></span><br><span class="line">    <span class="attr">&quot;**/.vscode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;**/.env&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>And a <code>.env</code> file:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PYTHONPATH=<span class="string">&quot;/private/var/tmp/sage-10.6-current/local/var/lib/sage/venv-python3.12.5/lib/python3.12/site-packages&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>With the corresponding outputs in your own Sagemath, of course.</p>
</blockquote>
<p>For those who favor using Jupyter Notebook, this also works. You just need to use Sagemath as a jupyter kernel, and Pylance will effectively parse your codes.</p>
<h2 id="A-Fresh-Take"><a href="#A-Fresh-Take" class="headerlink" title="A Fresh Take"></a>A Fresh Take</h2><p>Through further explorations, I discovered a more interesting method. You see, we can use <code>.../bin/sage-python</code> mentioned above as a python interpreter, can we set up a virtual environment using <code>venv</code>? The answer is yes, but it‚Äôs just a pure python environment (without <code>sage</code> package).</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">rec:/ $ /Applications/SageMath-10-6.app/Contents/Frameworks/Sage.framework/Versions/10.6/local/var/lib/sage/venv-python3.12.5/bin/sage-python -m venv new_sage_venv</span><br><span class="line">rec:/ $ <span class="built_in">source</span> new_sage_venv/bin/activate</span><br><span class="line">(new_sage_venv) rec:/ $ python</span><br><span class="line">Python 3.12.5 (main, Feb 25 2025, 12:37:41) [Clang 16.0.0 (clang-1600.0.26.6)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; from sage.all import *</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ModuleNotFoundError: No module named <span class="string">&#x27;sage&#x27;</span></span><br><span class="line">&gt;&gt;&gt; </span><br></pre></td></tr></table></figure>

<p>But it turns out that we can import <code>sage</code> by inheriting the system packages with <code>--system-site-packages</code>. In this way, all virtual environments created share the same Sagemath base environment, and we can make special configurations in each of them. </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">rec:/ $ /Applications/SageMath-10-6.app/Contents/Frameworks/Sage.framework/Versions/10.6/local/var/lib/sage/venv-python3.12.5/bin/sage-python -m venv new_sage_venv --system-site-packages</span><br><span class="line">rec:/ $ <span class="built_in">source</span> new_sage_venv/bin/activate</span><br><span class="line">(new_sage_venv) rec:/ $ python</span><br><span class="line">Python 3.12.5 (main, Feb 25 2025, 12:37:41) [Clang 16.0.0 (clang-1600.0.26.6)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; from sage.all import *</span><br><span class="line">&gt;&gt;&gt; GF</span><br><span class="line">&lt;sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory object at 0x1099ae490&gt;</span><br><span class="line">&gt;&gt;&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>It‚Äôs the same if you use <code>sage -python</code> to create one.</p>
</blockquote>
<p>The advantages are obvious: pure, independent virtual python environment with <code>sage</code> packages, which makes configuration and package management much easier. We don‚Äôt need any additional configurations described earlier. We just need to set the current virtual environment in VS Code and run our code as <code>python main.py</code>, install new package as <code>pip install package</code>‚Ä¶</p>
<p>Also, we can use this python interpreter for Jupyter Notebook.</p>
<p>With the new virtual environment, you can create the following <code>.vscode/settings.json</code> file in your VS Code:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;python.defaultInterpreterPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new_sage_venv/bin/python&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.terminal.activateEnvironment&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// activate the venv in vscode every time</span></span><br><span class="line">    <span class="attr">&quot;files.exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// this will hide the following setting files</span></span><br><span class="line">        <span class="attr">&quot;**/.vscode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/new_sage_venv&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Uhh, the end. I thought there‚Äôll be more to share but it turns out to be simple. Hope you enjoy this!</p>
]]></content>
      <tags>
        <tag>sagemath</tag>
      </tags>
  </entry>
  <entry>
    <title>zk-Openings::Srdnlen CTF 2025 Qual</title>
    <url>/2025/03/24/srdnlenctf2025/</url>
    <content><![CDATA[<p>Time: 2025.01.19-20 (online)</p>
<p>Interesting challenge, but I didn‚Äôt have enough time to solve it during the contest XDDD</p>
<h2 id="zk-Openings-0-solve"><a href="#zk-Openings-0-solve" class="headerlink" title="zk-Openings (0 solve)"></a>zk-Openings (0 solve)</h2><blockquote>
<ul>
<li><a href="https://github.com/srdnlen/srdnlenctf-2025_public/tree/main/crypto_zk-openings/src">https://github.com/srdnlen/srdnlenctf-2025_public&#x2F;tree&#x2F;main&#x2F;crypto_zk-openings&#x2F;src</a></li>
</ul>
</blockquote>
<p>I actually learnt a lot from the implementation, thank you @lrnzsir.</p>
<h3 id="KZG-Commitment"><a href="#KZG-Commitment" class="headerlink" title="KZG Commitment"></a>KZG Commitment</h3><p>KZG commitment is a polynomial commitment scheme proposed by <a href="https://www.iacr.org/archive/asiacrypt2010/6477178/6477178.pdf">Kate et al in 2010</a>.</p>
<p>While the original paper used a symmertric type-1 pairing, we prefer to use type-3 pairing these days. Basically we have three groups $(G_1, G_2, G_T)$ , two generators $(g_1 \in G_1, g_2 \in G_2)$, and a bilinear pairing function $e: G_1 \times G_2 \rightarrow G_T$. </p>
<ol>
<li>$\mathcal{Setup}(d) \rightarrow srs$: randomly samples a secret value $x$, and computes $srs &#x3D; (g_1^{x}, ‚Ä¶, g_1^{x^d}, g_2^{x})$. While $x$ is considered to be ‚Äútoxic waste‚Äù, it must be generated by trusted authority and deleted properly after use.</li>
<li>$\mathcal{Commit}(srs, f) \rightarrow com$: computes the commitment $com &#x3D; g_1^{\Sigma_{i&#x3D;0}^d f_i \cdot x^i} &#x3D; \Pi_{i&#x3D;0}^{d} (g_1^{x^i})^{f_i}$ for the polynomial.</li>
<li>$\mathcal{EvalProve}(srs, f, z) \rightarrow (\pi, f(z))$: computes a polynomial $q(x) &#x3D; \frac{f(x) - f(z)}{x-z}$. Then it computes the proof $\pi &#x3D; g_1^{\Sigma_{i&#x3D;0}^d q_i \cdot x^i} &#x3D; \Pi_{i&#x3D;0}^{d} (g_1^{x^i})^{q_i}$, proving that one knows the evaluation of $f$ over $z$.</li>
<li>$\mathcal{EvalVerify}(srs, com, \pi, z, f(z)) \rightarrow 0&#x2F;1$: verifies the proof by checking $e(com \cdot g_1^{-f(z)}, g_2) \overset{?}{&#x3D;} e(\pi, g_2^{s} \cdot g_2^{-z})$.</li>
</ol>
<blockquote>
<p>Note that KZG is a commitment (instead of ZKP) scheme. </p>
</blockquote>
<h3 id="The-Challenge"><a href="#The-Challenge" class="headerlink" title="The Challenge"></a>The Challenge</h3><p>For this challenge, we performs the KZG process on some secret polynomial $f$ and ended up with <code>opening.json</code>. Considering the difficulty of DLP under standard parameters, I actually just skip the content related to curve points. So basically we have $k&#x3D;20$ pairs of $(x_i, y_i&#x3D;f(x_i))$.</p>
<p>And here is how we get the secret polynomial. </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span> n <span class="keyword">in</span> AES.key_size <span class="comment"># 32</span></span><br><span class="line">key = os.urandom(n)</span><br><span class="line">evals = <span class="built_in">list</span>(key)</span><br><span class="line">poly = P(intt(evals))</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>(poly(H[i]) == key[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lcg</span>(<span class="params">m: <span class="built_in">int</span>, a: <span class="built_in">int</span>, c: <span class="built_in">int</span>, x: <span class="built_in">int</span></span>) -&gt; <span class="string">&quot;Generator[int, None, None]&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Linear Congruential Generator &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x = (a * x + c) % m</span><br><span class="line">        <span class="keyword">yield</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a, c, x = [secrets.randbelow(p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">rng = lcg(p, a, c, x)</span><br><span class="line"></span><br><span class="line">k = <span class="number">20</span></span><br><span class="line">hiding_poly = P([<span class="built_in">next</span>(rng) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(k)])</span><br><span class="line">hidden_poly = poly + hiding_poly * Z_H</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>(hidden_poly(H[i]) == key[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br></pre></td></tr></table></figure>

<p>In short, we have a 32-degree polynomial $f(x)$ and a 20-degree polynomial $g(x)$, where $f(H_i) &#x3D; key_i$ and $g_i$ is generated successively by a secret LCG. Then we have our secret polynomial $h(x) &#x3D; f(x) + g(x) \cdot (x^n-1)$ satisfying $h(H_i) &#x3D; f(H_i) &#x3D; key_i$ since $H_i^n &#x3D; 1$.</p>
<p>According to previous discussion, we have 20 pairs of random points $(x_i, h(x_i))$, which is apparently not enough to recover $h(x)$. Considering $key_i$ is very small compared to $p$, LLL is our option. </p>
<p>We can‚Äôt construct the Lattice directly, but we can resort to $g(x)$. The first step is to establish a linear representation between $g(x)$ and $key_i$, which is quite simple, since <code>ntt</code>, <code>intt</code> and <code>polynomial_evaluation</code> are all linear transformations. </p>
<ul>
<li>$\vec{key} &#x3D; NTT_{n \times n} \cdot \vec{f}$</li>
<li>$\vec{y} &#x3D; X_{k \times (n+k)} \cdot \vec{h} &#x3D; FX_{k \times n} \cdot \vec{f}+ GX_{k \times k} \cdot \vec{g}$</li>
</ul>
<p>$\Rightarrow \vec{g} &#x3D; GX^{-1} \cdot (\vec{y} - FX \cdot NTT^{-1} \cdot \vec{key})$</p>
<p>For $NTT^{-1}$, you can also compute $iNTT$.</p>
<h3 id="Linearization-for-Unknown-LCG"><a href="#Linearization-for-Unknown-LCG" class="headerlink" title="Linearization for Unknown LCG"></a>Linearization for Unknown LCG</h3><p>We know that $g_{i+1} &#x3D; a \cdot g_i + b$, but $(a, b)$ are randomly chosen on $GF_p$. To get rid of them, we construct equations like $(g_{i+d_0} - g_{i}) \cdot (g_{j+d_1} - g_{j}) &#x3D; (g_{i+d_1} - g_{i}) \cdot (g_{j+d_0} - g_{j})$.</p>
<p>Here comes an interesting (maybe) question: how many linearly independent equations can we get? Well this did appealled to me and @Á≥ñÈÜãÂ∞èÈ∏°Âùó. Since we can get $k-2$ equations like $y_{i+1} &#x3D; a \cdot y_i$, we can choose any two of them to eliminate $a$, and thus we have $C(k-2, 2)$ equations.</p>
<p>For @lrnzsir‚Äôs strategy, he iterates $(g_{i+2}-g_{i+1}) \cdot (g_{j+1}-g_j) &#x3D; (g_{i+1}-g_i) \cdot (g_{j+2}-g_{j+1})$ for all $i, j \in [k - 2]$ and $i &lt; j$. We can get exactly $C(k-2, 2)$ equations and each equation contains a unique binomial (thus linear independent). So this is the best we can get.</p>
<blockquote>
<p>We (@Á≥ñÈÜãÂ∞èÈ∏°Âùó) believe there exists a better way for theoratical analysis.</p>
</blockquote>
<p>With linear transformation, we have $C(k-2, 2)$ quadratic equations about $key_i$ now, containing $n + C(n+1, 2)$ monomials. Then we can do LLL on the linearized system to recover the key. One can ignore some equations and utilize <code>flatter</code> for better efficiency.</p>
<blockquote>
<p><a href="zk-Openings/exp.py">exp.py</a></p>
</blockquote>
<p>There maybe some difference in my code since it‚Äôs implemented months ago XD</p>
]]></content>
      <tags>
        <tag>LLL</tag>
        <tag>KZG</tag>
      </tags>
  </entry>
  <entry>
    <title>Srdnlen CTF 2025 Final (Sardinia, ItalyüáÆüáπ)</title>
    <url>/2025/09/29/srdnlenctffinal2025/</url>
    <content><![CDATA[<p>Time: 2025.09.25-26 (onsite)</p>
<p>I attended the first Srdnlen CTF Final with r3kapig, and we ended up as rk7.</p>
<p>We really enjoyed the whole event, sincere thanks to all srdnlen fellas :D</p>
<p><img src="/2025/09/29/srdnlenctffinal2025/images/scoreboard.png" alt="scoreboard"></p>
<p><img src="/2025/09/29/srdnlenctffinal2025/images/solves.jpg" alt="solves"></p>
<h2 id="lone-ranger-10-solves"><a href="#lone-ranger-10-solves" class="headerlink" title="lone-ranger (10 solves)"></a>lone-ranger (10 solves)</h2><blockquote>
<ul>
<li><a href="lone-ranger/ecc.py">ecc.py</a></li>
<li><a href="lone-ranger/field.py">field.py</a></li>
<li><a href="lone-ranger/kzg.py">kzg.py</a></li>
<li><a href="lone-ranger/prover.py">prover.py</a></li>
<li><a href="lone-ranger/transcript.py">transcript.py</a></li>
<li><a href="lone-ranger/output.json">output.json</a></li>
<li><a href="lone-ranger/srs.json">srs.json</a></li>
</ul>
</blockquote>
<p>People solving this challenge insanely fast, so we assumed it‚Äôs easier than it looks like. Then gpt-5 cooked the challenge in minutes.</p>
<p>I should still go through the whole challenge later, maybe.</p>
<h2 id="multiple-issues-4-solves"><a href="#multiple-issues-4-solves" class="headerlink" title="multiple-issues (4 solves)"></a>multiple-issues (4 solves)</h2><blockquote>
<ul>
<li><a href="multiple-issues/server.py">server.py</a></li>
</ul>
</blockquote>
<p>In this challenge we need to forge a valid UOV signature with a 256-time oracle.</p>
<h3 id="Vuln"><a href="#Vuln" class="headerlink" title="Vuln"></a>Vuln</h3><p>Let‚Äôs take a deeper look into the funciton <code>sign</code>:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UOV</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expand_from_seed</span>(<span class="params">self, seed: <span class="built_in">bytes</span>, shape: <span class="built_in">tuple</span></span>) -&gt; np.ndarray:</span><br><span class="line">        a = np.frombuffer(hashlib.shake_256(seed).digest(np.prod(shape)), dtype=np.uint8)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.F(a % <span class="variable language_">self</span>.q).reshape(shape)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self, msg: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        h = <span class="variable language_">self</span>.expand_from_seed(msg, (<span class="variable language_">self</span>.m,))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># deterministic signature thanks to Fiat-Shamir With Aborts</span></span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            v = <span class="variable language_">self</span>.expand_from_seed(<span class="variable language_">self</span>.sigma + msg + int_to_bytes(k), (<span class="variable language_">self</span>.n,))     <span class="comment"># &lt;-----</span></span><br><span class="line">            M = <span class="variable language_">self</span>.F([v @ <span class="variable language_">self</span>.priv[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.m)])</span><br><span class="line">            u = h - <span class="variable language_">self</span>.F([v @ <span class="variable language_">self</span>.pub[i] @ v <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.m)])</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                o = <span class="variable language_">self</span>.O @ np.linalg.solve(M, u)</span><br><span class="line">                <span class="keyword">return</span> (o + v).tobytes()</span><br><span class="line">            <span class="keyword">except</span> np.linalg.LinAlgError:</span><br><span class="line">                k += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>If we can find two signatures with the same $v$ but different $o$, we can extract a vector $o \in \mathcal{O}$. So the core idea is to find the collision of <code>self.expand_from_seed(self.sigma + msg + int_to_bytes(k), (self.n,))</code>.</p>
<p>An interesting fact is <code>int_to_bytes(0) = &#39;&#39;</code>. Suppose we have <code>msg0</code> and <code>msg1 = msg0+int_to_bytes(k0)</code>. If we have: </p>
<ul>
<li><code>v0 = expand(sigma+msg0+int_to_bytes(k))</code> aborts at <code>k = k0</code>. </li>
<li><code>v1 = expand(sigma+msg1+int_to_bytes(k))</code> aborts at <code>k = 0</code>.</li>
</ul>
<p>This constructs a collision: </p>
<ul>
<li><code>v1 = expand(sigma+msg1+&#39;&#39;) = expand(sigma+msg0+int_to_bytes(k0)) = v0</code>.</li>
</ul>
<p>Our strategy is to set a random <code>msg[0]</code> and let <code>msg[i+1] = msg[i] + int_to_bytes(1)</code> (you can also use other <code>k</code>). The collision will take place when <code>msg[i]</code> aborts at <code>k = 1</code>, and <code>msg[i+1]</code> aborts at <code>k = 0</code>. You can find the answer with the fact that $\mathcal{O}$ is the kernel space of the public key.</p>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>For convenience, I may use quadratic mapping style expression:</p>
<ul>
<li>$\mathcal{P}_i(v) &#x3D; v \cdot P_i \cdot v$.</li>
<li>$\mathcal{P}_i‚Äô(v_i, v_j) &#x3D; v_i \cdot P_i \cdot v_j$.</li>
</ul>
<p>With a single nontrivial vector $o \in \mathcal{O}$ leaked, we can recover the whole kernel space $\mathcal{O}$. For this part, we used <a href="https://affine.group/writeup/2023-07-CorCTF-OilSpill">Hellman‚Äôs writeup</a>.</p>
<p>The general idea is to extract the kernel space of $\mathcal{K} &#x3D; \ker(\{ o \cdot P_i \}_i)$ first, where $\dim(\mathcal{K}) &#x3D; n-m$. Here we have $\mathcal{P}_i(v) &#x3D; 0$ for any $v \in \mathcal{K}$. This also works for $\mathcal{O}$ but stronger: we have $\mathcal{P}_i‚Äô(v_i, v_j) &#x3D; 0$ for any $v_i, v_j \in \mathcal{O}$. So $\mathcal{O} \subset \mathcal{K}$ and $\dim(\mathcal{O}) &#x3D; m$.</p>
<p>Consider the basis set $\mathcal{K} &#x3D; \operatorname{span}(K_{n, n-m})$ and $\mathcal{O} &#x3D; \operatorname{span}(O_{n, m})$. We can always find a linear transformation $B_{n-m, m}$ s.t. $O &#x3D; K \cdot B$. Then we have $O^T \cdot P_i \cdot O &#x3D; B^T \cdot (K^T \cdot P_i \cdot K) \cdot B &#x3D; 0$, and we can extract such $B$ from $\ker(K^T \cdot P_i \cdot K)$, thus recovering the whole $\mathcal{O}$.</p>
<h2 id="pqke-2-solves"><a href="#pqke-2-solves" class="headerlink" title="pqke (2 solves)"></a>pqke (2 solves)</h2><blockquote>
<ul>
<li><a href="pqke/ring.py">ring.py</a></li>
<li><a href="pqke/server.py">server.py</a></li>
</ul>
</blockquote>
<p>In this challenge we need to crack a MLWE-based KE scheme.</p>
<h3 id="Tricky-Trick"><a href="#Tricky-Trick" class="headerlink" title="Tricky Trick"></a>Tricky Trick</h3><p>The parameters used in this challenge is slightly weaker than Kyber256 (consider RLWE in Kyber512), with a larger modulus $q &#x3D; 65537$. But this still does NOT give us enough advantage to solve the RLWE.</p>
<p>The key part of this challenge is a tricky way to generate uniform polynomials:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Ring</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">binomial</span>(<span class="params">self, f: <span class="built_in">callable</span> = <span class="literal">None</span></span>) -&gt; <span class="string">&quot;RingElem&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            f = <span class="keyword">lambda</span>: secrets.randbits(<span class="variable language_">self</span>.s).bit_count() - secrets.randbits(<span class="variable language_">self</span>.s).bit_count()</span><br><span class="line">        <span class="keyword">return</span> RingElem(<span class="variable language_">self</span>, coeffs=<span class="variable language_">self</span>.Zq(np.array([f() % <span class="variable language_">self</span>.q <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.n)])))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">uniform</span>(<span class="params">self</span>) -&gt; <span class="string">&quot;RingElem&quot;</span>:</span><br><span class="line">        elem = <span class="variable language_">self</span>.binomial()</span><br><span class="line">        <span class="keyword">return</span> RingElem(<span class="variable language_">self</span>, evals=elem.coeffs)</span><br></pre></td></tr></table></figure>

<p>The challenge use <code>binomial</code> to generate small polynomials, the same way as in Kyber and Dilithium. But it calls <code>binomial</code> first and use the evaluations to generate uniform polynomials. This means the evaluations of the uniform polynomial $f(x_i)$ on the NTT points $x_i$ are small. If the evaluation $f(x_i) &#x3D; 0$ (with a non-negligible probability), $f$ contains $(x-x_i)$ as a factor, which serves as a common factor with $x^n+1 &#x3D; \Pi_i (x - x_i)$.</p>
<p>Based on experiments, we can get a 45-degree common factor on average.</p>
<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><p>What can we do with this? Basically we can use the common factors to eliminate some variables and leak information about the others.</p>
<p>Consider a single part of the MLWE as a RLWE instance: $b(x) &#x3D; s_0(x) \cdot m_0(x) + s_1(x) \cdot m_1(x) + e(x) \pmod{x^n+1}$. Let $g_{0, 1}(x) &#x3D; \gcd(m_0(x), m_1(x), x^n+1)$, we have $b(x) &#x3D; e(x) \pmod{g_{0, 1}(x)}$, which leads to a easier scenario (compared to the original one). And we can solve $e(x)$ with lattice reduction if the degree of $g(x)$ is big enough.</p>
<p>Then we can solve the secret polynomials $(s_0(x), s_1(x))$ with $e(x)$. This time we use $g_0(x) &#x3D; \gcd(m_0(x), x^n + 1)$, and $b(x) - e(x) &#x3D; s_1(x) \cdot m_1(x) \pmod{g_0(x)}$. Now we can solve $s_1(x)$ (and $s_0(x)$ similarly).</p>
<h2 id="aes-3-solves"><a href="#aes-3-solves" class="headerlink" title="(*)aes (3 solves)"></a>(*)aes (3 solves)</h2><blockquote>
<ul>
<li><a href="aes/server.py">server.py</a></li>
<li><a href="aes/sboxes.json">sboxes.json</a></li>
</ul>
</blockquote>
<p>In this challenge we need to crack a cursed AES with a decryption oracle.</p>
<h3 id="Cursed-Key-Expansion"><a href="#Cursed-Key-Expansion" class="headerlink" title="Cursed Key Expansion"></a>Cursed Key Expansion</h3><p>Apart from the cipher structure, the main change in the challenge is <code>expand_key</code>, with a strange series of sboxes. It can be noticed that the new sboxes contain several n-to-1 mappings. With deeper experiments, we found that this leads to the round keys gradually converging to a fixed value.</p>
<p>Converging to the love for Sardinia, yay.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> server <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">aes = AES(key=os.urandom(<span class="number">16</span>))</span><br><span class="line"><span class="keyword">for</span> i, ki <span class="keyword">in</span> <span class="built_in">enumerate</span>(aes.round_keys):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ki&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\x802&lt;\xc7\xa7]\xc97u\x0f\xed@\xd2\x0c\xdd\x0c&#x27;</span></span><br><span class="line"><span class="string">b&#x27;9\x06:\x9b)\xb4&#123;&#125;\x10=sX&quot;n\xb2\x17&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\x14\x9d\x1c\xc5\xa8\x0fa\x91\x80\xd0j9un1\x18&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\x1b\xf19y\xc2\xc3\x1c\x88\\4\x0f~)n1D&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xd6\xd2\xe0\x940\xa6\xa3\xd3\xe74\xe0\x9din1b&#x27;</span></span><br><span class="line"><span class="string">b&#x27;W3\xddl0ve\x04\x0c4r\xfbin1\xf6&#x27;               &lt;-----</span></span><br><span class="line"><span class="string">b&#x27;W3_l0ve_$4rdin1@&#x27;</span></span><br><span class="line"><span class="string">b&#x27;W3_l0ve_$4rdin1@&#x27;</span></span><br><span class="line"><span class="string">b&#x27;W3_l0ve_$4rdin1@&#x27;</span></span><br><span class="line"><span class="string">b&#x27;W3_l0ve_$4rdin1@&#x27;</span></span><br><span class="line"><span class="string">b&#x27;W3_l0ve_$4rdin1@&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>The 6 round still has uncertainties, but it converges with an acceptable probability (1&#x2F;1024 approximately). This gives us a chance to extract a 4-round AES-style cipher from the original one. With a decryption oracle, square attack is a good choice.</p>
<p>I didn‚Äôt have time to implement the attack when I figured it out, however.</p>
<h3 id="4-Round-Square-Attack"><a href="#4-Round-Square-Attack" class="headerlink" title="4-Round Square Attack"></a>4-Round Square Attack</h3><p>For this attack you may find <a href="https://www.davidwong.fr/blockbreakers/">this</a> helpful. The last time I implemented the attack was in 2023, for Blocky challenges in PBCTF and 0CTF. </p>
<p>In square attack we need a $\Lambda$-set, like <code>[bytes([i] + [0]*15) for i in range(256)]</code>, where all elements have only one different byte. An interesting fact is that <code>sub_bytes</code> and <code>add_round_key</code> does not disrupt the structure of the set, while <code>mix_columns</code> combined with <code>shift_rows</code> does.</p>
<p><img src="/2025/09/29/srdnlenctffinal2025/aes/4-r-square-attack.jpg" alt="4-r-square-attack"></p>
<p>Let‚Äôs conduct a brief analysis on how the $\Lambda$-set changes (with this famous and clear flowchart by david). At the very beginning, there‚Äôs only one <strong>active</strong> byte. After the first <code>mix_columns</code>, the corresponding bytes in the other rows also get activated. And with the effect of <code>shift_rows</code>, the next <code>mix_columns</code> makes it even more chaotic.</p>
<p>After the <strong>third</strong> <code>mix_columns</code>, our $\Lambda$-set does not exist anymore, but our adventure‚Äôs not over yet. At this point, each byte of the element is a linear combination of 4 previous active bytes, and we can get a linear combination of 4 zero if we sum them up (for ‚Äúsum them up‚Äù I mean <code>pt[0][i] ^ pt[1][i]...</code>).</p>
<p>The core of the attack is the fact that, the phenomenon described above provides us a key distinguisher.</p>
<p>The following <code>add_round_key</code> does not change anything, but after <code>sub_byte</code> things will be different. For each byte of the last <code>round_keys[-1]</code> we can bruteforce it, step back to before the last <code>sub_bytes</code>, and recover <code>round_keys[-1]</code> by checking whether the property of the $\Lambda$-set holds. People should know that this is a parallel-friendly strategy.</p>
<h3 id="5-Round-Square-Attack"><a href="#5-Round-Square-Attack" class="headerlink" title="5-Round Square Attack"></a>5-Round Square Attack</h3><p>One more round added, but there‚Äôre no significant changes actually.</p>
<p><img src="/2025/09/29/srdnlenctffinal2025/aes/5-r-square-attack.jpg" alt="5-r-square-attack"></p>
<p>We still need the distinguisher, which means more effort to reverse the output backward to the point. Since there lies another <code>mix_columns</code> between the output and our target, we may have to recover 4 bytes of states in a group (bruteforcing 4 bytes of <code>round_keys[-1]</code>) at one time. The positions of the bytes are determined by <code>shift_rows</code>, as shown in the figure. </p>
<p>An interesting trick is that we can always swap <code>mix_columns</code> and <code>add_round_key</code>. In this way, we only need to bruteforce <code>round_keys[-2]</code> byte by byte (instead of in groups of 4). Then we can recover <code>round_keys[-1]</code> with the distinguisher.</p>
<p>The overall computational cost for a group of 4 keys is $\mathcal{O}(2^{40})$ (4+1 bytes). This is also highly parallelizable, thus leading to a $\mathcal{O}(k \cdot 2^{32})$. For implementation we may have to use cpp (or golang).</p>
<h2 id="it-hiding"><a href="#it-hiding" class="headerlink" title="(*)it-hiding"></a>(*)it-hiding</h2><p>This challenge is for speed-run on the second day.</p>
<blockquote>
<ul>
<li><a href="it-hiding/server.py">server.py</a></li>
</ul>
</blockquote>
<p>In this challenge we need to solve a Pedersen Commitment decision problem.</p>
<h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><p>Curve W25519 in this challenge is isomorphic to curve ed25519, with the curve order $8 \cdot q$. Since <code>fastecdsa</code> use a $q$-order generator $G$, an apparent solution is to integrate a point in another subgroup, thus changing the order of the commitment $C$. People can be inspired by the Schnorr part ig, which forces the user to send a point generated by $G$.</p>
<p>Consider we‚Äôre taking a 2-order point $B$, how can we by pass the Schnorr part? In Schnorr proof, we need to send $B, (z, c)$ satisfying $\operatorname{challenge}(z \cdot G-c \cdot B, B) &#x3D; c$. Though we‚Äôre not able to predict $c$, we know the fact that $c \cdot B &#x3D; O$ for any even $c$ (since $B$ is a 2-order point). Thus we can randomly pick $z$ for several times and compute $c &#x3D; \operatorname{challenge}(z \cdot G, B)$, and we can successfully forge a valid proof $(z, c)$ when we get an even $c$. This may lead to a 50% success rate, acceptable.</p>
<blockquote>
<ul>
<li><a href="it-hiding/exp.py">exp.py</a></li>
</ul>
</blockquote>
<p>One team used the time difference to do the decision, which seems to work locally. But I think this may be influenced badly by network delay and <code>fastecdsa</code>.</p>
<p>Yeah I didn‚Äôt manage to solve it in time, cuz I misused $8 \cdot q$ instead of $q$ while forging a proof, disappointment.</p>
<h2 id="Milan-Sardinia-Rome"><a href="#Milan-Sardinia-Rome" class="headerlink" title="Milan -&gt; Sardinia -&gt; Rome"></a>Milan -&gt; Sardinia -&gt; Rome</h2><p>My first time to EU, fascinated.</p>
<p>Painful that I had to spend 30 hours on the plane, with bad sleep and endless plane food. But you always need to pay something ig.</p>
<table>
<thead>
<tr>
<th><img src="images/flight1.jpg" height="200"></th>
<th><img src="images/flight2.jpg" height="200"></th>
</tr>
</thead>
</table>
<p>My body arrived in Milan early in the morning (while my soul arrived after hours), and honestly the weather was very cold, gloomy and frustrating. But when we landed in Sardinia, things got better. I myself is kinda weather-sensitive so that was such a relief.</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/milan.jpg" alt="milan"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/sardinia.jpg" alt="sardinia"></th>
</tr>
</thead>
</table>
<p>No so sure I had Linguine or Spaghetti that night.</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/day1dinner.jpg" alt="day1dinner"></th>
</tr>
</thead>
</table>
<p>The CTF event‚Äôs just impressive. We really enjoyed all crypto challenges (it‚Äôd be better if we cleared them XD).</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/event1.jpg" alt="event1"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/event2.jpg" alt="event2"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/event3.jpg" alt="event3"></th>
</tr>
</thead>
</table>
<p>I had to refresh myself from time to time because of jet lag, taking a glimpse of the local life. I may spend more days on the island next time, if possible.</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/sardinia1.jpg" alt="sardinia1"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/sardinia2.jpg" alt="sardinia2"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/sardinia3.jpg" alt="sardinia3"></th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/sardinia4.jpg" alt="sardinia4"></th>
</tr>
</thead>
</table>
<p>The first night‚Äôs pizza was on the host, and I had Spaghetti and Macaroni on the second day.</p>
<p>Of courese I had things other than noodles lmao. It‚Äôs just fun trying to pick up different pastas.</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/spaghetti.jpg" alt="spaghetti"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/macaroni.jpg" alt="macaroni"></th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/pizza.jpg" alt="pizza"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/food.jpg" alt="food"></th>
</tr>
</thead>
</table>
<p>Shouldn‚Äôt post the photo of them ig. But I think it‚Äôs a cool one XD</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/bar.jpg" alt="bar"></th>
</tr>
</thead>
</table>
<p>We spent one day and a half in Rome after the event. Here comes Rome‚Äôs Day and Night.</p>
<p>I love pleasant weathers.</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/dayrome1.jpg" alt="dayrome1"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/dayrome3.jpg" alt="dayrome3"></th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/dayrome2.jpg" alt="dayrome2"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/dayrome4.jpg" alt="dayrome4"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/dayrome5.jpg" alt="dayrome5"></th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/nightrome1.jpg" alt="nightrome1"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/nightrome3.jpg" alt="nightrome3"></th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/nightrome2.jpg" alt="nightrome2"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/nightrome4.jpg" alt="nightrome4"></th>
</tr>
</thead>
</table>
<p>A lemonüçã</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/lemon.jpg" alt="lemon"></th>
</tr>
</thead>
</table>
<p>I had Fettuccine for my last meal before leaving. They‚Äôre all tasty, but noodles will not be an option for my next month ig.</p>
<table>
<thead>
<tr>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/fettuccine.jpg" alt="fettuccine"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/beef.jpg" alt="beef"></th>
<th><img src="/2025/09/29/srdnlenctffinal2025/images/chicken.jpg" alt="chicken"></th>
</tr>
</thead>
</table>
]]></content>
      <tags>
        <tag>LLL</tag>
        <tag>AES</tag>
        <tag>ECC</tag>
        <tag>UOV</tag>
        <tag>ZKP</tag>
      </tags>
  </entry>
</search>
